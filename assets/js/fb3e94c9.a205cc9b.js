"use strict";(self.webpackChunktuyaopen_io_website=self.webpackChunktuyaopen_io_website||[]).push([[6484],{7107:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-src-06da21c692c0ef69193d41fc18dd78d8.png"},7261:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"new-hardware/new-platform","title":"Create platform","description":"Overview","source":"@site/docs/new-hardware/new-platform.md","sourceDirName":"new-hardware","slug":"/new-hardware/new-platform","permalink":"/docs/new-hardware/new-platform","draft":false,"unlisted":false,"editUrl":"https://github.com/Tuya-Community/TuyaOpen.io/edit/master/docs/new-hardware/new-platform.md","tags":[],"version":"current","frontMatter":{"title":"Create platform"},"sidebar":"docs","previous":{"title":"Button Driver","permalink":"/docs/peripheral/button"},"next":{"title":"Create board","permalink":"/docs/new-hardware/new-board"}}');var o=n(74848),r=n(28453);const l={title:"Create platform"},s="Create platform",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Operation Principle",id:"operation-principle",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Platform Initialization",id:"platform-initialization",level:3},{value:"Configure Build Tools",id:"configure-build-tools",level:3},{value:"Configure Special Header File Paths (Optional)",id:"configure-special-header-file-paths-optional",level:3},{value:"Fill in the Code",id:"fill-in-the-code",level:3},{value:"Build and Link",id:"build-and-link",level:3},{value:"About Firmware Flashing (Optional)",id:"about-firmware-flashing-optional",level:3},{value:"Configure Repository Information (Optional)",id:"configure-repository-information-optional",level:3},{value:"FAQ",id:"faq",level:2}];function c(e){const i={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.header,{children:(0,o.jsxs)(i.h1,{id:"create-platform",children:["Create ",(0,o.jsx)(i.code,{children:"platform"})]})}),"\n",(0,o.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsxs)(i.p,{children:["Use the command ",(0,o.jsx)(i.code,{children:"tos.py new platform"})," to create a new hardware platform porting template."]}),"\n",(0,o.jsx)(i.p,{children:"This command is intended for developers who want to port TuyaOS to a new hardware chip or development board that is not officially supported yet. It will automatically generate a complete directory structure and basic code files for adapting to the new hardware."}),"\n",(0,o.jsxs)(i.p,{children:["Summary: The new platform command greatly simplifies the workload of porting TuyaOS to new hardware. Developers do not need to manually create all the required files and directories. Just run this command and then focus on implementing the hardware-specific driver code in the generated template files (",(0,o.jsx)(i.code,{children:".c"})," and ",(0,o.jsx)(i.code,{children:".h"}),")."]}),"\n",(0,o.jsx)(i.h2,{id:"operation-principle",children:"Operation Principle"}),"\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Enter the command ",(0,o.jsx)(i.code,{children:"tos.py new platform"}),": You will be prompted to enter the name of the new platform (e.g., ",(0,o.jsx)(i.code,{children:"my_new_chip"}),")."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"input new platform",src:n(47913).A+"",width:"565",height:"140"})}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"Generate Kconfig configuration:"}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Create a top-level ",(0,o.jsx)(i.code,{children:"Kconfig"})," file to integrate the new platform into the project's configuration system."]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["A ",(0,o.jsx)(i.code,{children:"menuconfig"})," interactive interface will pop up, allowing you to select which basic features (such as WIFI, BLE, GPIO, I2C, etc.) this new platform needs to support. Your selections will be saved in a ",(0,o.jsx)(i.code,{children:"default.config"})," file."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"menuconfig",src:n(41724).A+"",width:"1393",height:"1068"})}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Create the platform directory: A folder named after your input (e.g., ",(0,o.jsx)(i.code,{children:"platform/my_new_chip"}),") will be created under the ",(0,o.jsx)(i.code,{children:"platform/"})," directory."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"new platform folder",src:n(99407).A+"",width:"1292",height:"322"})}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Copy adapter layer templates: According to your previous selections, the corresponding hardware abstraction layer (TKL - Tuya Kernel Layer) interface templates will be copied from the ",(0,o.jsx)(i.code,{children:"tools/porting/adapter"})," directory to ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/tuyaos/"}),"."]}),"\n",(0,o.jsxs)(i.ul,{children:["\n",(0,o.jsx)(i.li,{children:"For example, if you checked the WIFI feature, the WIFI-related template files such as tkl_init_wifi.c and tkl_init_wifi.h will be copied over."}),"\n"]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"new tuyaos",src:n(68236).A+"",width:"655",height:"897"})}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Create board-level configuration: A folder with the same name (e.g., ",(0,o.jsx)(i.code,{children:"boards/my_new_chip"}),") will also be created under the ",(0,o.jsx)(i.code,{children:"boards/"})," directory, and a corresponding ",(0,o.jsx)(i.code,{children:"Kconfig"})," file will be generated to add this new platform as an option in the build system."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"new board folder",src:n(58381).A+"",width:"1113",height:"302"})}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Build verification: Use the command ",(0,o.jsx)(i.code,{children:"tos.py new project"})," to create a new project, select the ",(0,o.jsx)(i.code,{children:"my_new_chip"})," platform, and use the command ",(0,o.jsx)(i.code,{children:"tos.py build"})," to build and verify."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"new project",src:n(34717).A+"",width:"457",height:"317"})}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"build project",src:n(70779).A+"",width:"842",height:"255"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(i.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsx)(i.p,{children:"Overview:"}),"\n",(0,o.jsxs)(i.blockquote,{children:["\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/platform_prepare.py"})," file to complete platform initialization, such as toolchain download operations"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/toolchain_file.cmake"})," file to configure the actual path of the build tools and build options"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:(0,o.jsxs)(i.em,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/platform_config.cmake"})," file to configure header file paths used by the application layer (optional)"]})}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["In the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/tuyaos/tuyaos_adapter/src"})," directory, fill in the actual hardware driver code as prompted"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/build_example.py"})," file to complete the build and link steps"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:(0,o.jsxs)(i.em,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/platform_config.yaml"})," file to configure repository git information (optional)"]})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(i.h3,{id:"platform-initialization",children:"Platform Initialization"}),"\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/platform_prepare.py"})," file to complete platform initialization, such as toolchain download operations."]}),"\n",(0,o.jsx)(i.p,{children:"This script will be executed first during the build process."}),"\n",(0,o.jsxs)(i.p,{children:["Please complete the required build tool downloads in this script. It is recommended to download the toolchain to the ",(0,o.jsx)(i.code,{children:"platform/tools"})," directory."]}),"\n",(0,o.jsxs)(i.p,{children:["The download logic can be developed independently or refer to the implementation of other official platforms (",(0,o.jsx)(i.code,{children:"T5AI"}),", ",(0,o.jsx)(i.code,{children:"ESP32"}),")."]}),"\n",(0,o.jsx)(i.p,{children:"If there are other operations that need to be completed before compilation, they can also be implemented in this script."}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"platform prepare",src:n(12744).A+"",width:"1015",height:"775"})}),"\n",(0,o.jsx)(i.h3,{id:"configure-build-tools",children:"Configure Build Tools"}),"\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/toolchain_file.cmake"})," file to configure the actual path of the build tools and build options."]}),"\n",(0,o.jsxs)(i.p,{children:["This file needs to specify the actual paths of build tools such as ",(0,o.jsx)(i.code,{children:"gcc"}),", ",(0,o.jsx)(i.code,{children:"g++"}),", ",(0,o.jsx)(i.code,{children:"ar"}),", etc., as well as build options."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"toolchain_file",src:n(15756).A+"",width:"1002",height:"849"})}),"\n",(0,o.jsx)(i.h3,{id:"configure-special-header-file-paths-optional",children:"Configure Special Header File Paths (Optional)"}),"\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/platform_config.cmake"})," file to configure header file paths used by the application layer."]}),"\n",(0,o.jsxs)(i.p,{children:["According to the cross-platform design of ",(0,o.jsx)(i.code,{children:"TuyaOpen"}),", it should only include header file paths related to ",(0,o.jsx)(i.code,{children:"tuyaos_adapter"}),", which have already been generated in the template."]}),"\n",(0,o.jsx)(i.p,{children:"However, if your platform needs to expose other header files to the application layer, you can add them in this file."}),"\n",(0,o.jsxs)(i.p,{children:["The variable ",(0,o.jsx)(i.strong,{children:(0,o.jsx)(i.code,{children:"PLATFORM_PUBINC"})})," is used to specify the header file paths used by the application layer. You can modify this variable to add header file paths."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"platform config",src:n(83847).A+"",width:"1232",height:"384"})}),"\n",(0,o.jsx)(i.h3,{id:"fill-in-the-code",children:"Fill in the Code"}),"\n",(0,o.jsxs)(i.p,{children:["In the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/tuyaos/tuyaos_adapter/src"})," directory, fill in the actual hardware driver code as prompted."]}),"\n",(0,o.jsx)(i.p,{children:"This process is the most important part, requiring the writing of corresponding driver code according to the specific hardware platform characteristics."}),"\n",(0,o.jsxs)(i.p,{children:["During the template creation process, some necessary interface function templates have been generated. Implement the specific logic of these functions in the corresponding ",(0,o.jsx)(i.code,{children:".c"})," files."]}),"\n",(0,o.jsxs)(i.p,{children:["Since ",(0,o.jsx)(i.code,{children:"TuyaOpen"})," uses exactly the same underlying interface as ",(0,o.jsx)(i.code,{children:"TuyaOS"}),", you can follow the ",(0,o.jsx)(i.a,{href:"https://developer.tuya.com/cn/docs/iot-device-dev/TuyaOS-translation_linux?id=Kcrwrf72ciez5#title-1-Adapt-RTC",children:"TuyaOS Porting Guide"})," and ",(0,o.jsx)(i.a,{href:"https://developer.tuya.com/cn/docs/iot-device-dev/TuyaOS-translation_rtos?id=Kcrwraf21847l#title-1-Adapt-entry-point",children:"RTOS Porting Guide"})," for adaptation."]}),"\n",(0,o.jsx)(i.p,{children:(0,o.jsx)(i.img,{alt:"tuyaos adapter src",src:n(7107).A+"",width:"1920",height:"1080"})}),"\n",(0,o.jsx)(i.h3,{id:"build-and-link",children:"Build and Link"}),"\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/build_example.py"})," file to complete the build and link steps."]}),"\n",(0,o.jsx)(i.p,{children:"This script can be modified according to the build method of the new platform. This script needs to complete three steps:"}),"\n",(0,o.jsxs)(i.blockquote,{children:["\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Compile the source code files in the ",(0,o.jsx)(i.code,{children:"tuyaos_adapter"})," directory"]}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsx)(i.p,{children:"Compile other source code files needed internally by the platform"}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:["Link the build products with the ",(0,o.jsx)(i.code,{children:"TuyaOpen"})," upper-layer products ",(0,o.jsx)(i.code,{children:"libtuyaapp.a libtuyaos.a"})," into an executable file"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(i.p,{children:["It should be noted that this script accepts two parameters: ",(0,o.jsx)(i.code,{children:"params_path"})," and ",(0,o.jsx)(i.code,{children:"user_cmd"}),"."]}),"\n",(0,o.jsxs)(i.ol,{children:["\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.code,{children:"params_path"})," is the path to the build parameter file, providing three formats: cmake/config/json, which can be accessed using ",(0,o.jsx)(i.code,{children:"${BUILD_PARAM_PATH}/build_param.cmake"}),"."]}),"\n",(0,o.jsxs)(i.p,{children:["The parameter file will provide various parameters required for compilation, such as ",(0,o.jsx)(i.code,{children:"OPEN_ROOT/OPEN_HEADER_DIR/OPEN_LIBS_DIR/PLATFORM_NEED_LIBS"}),", etc."]}),"\n",(0,o.jsx)(i.p,{children:"In addition, the results of function configuration are also in this parameter file and can be used."}),"\n"]}),"\n",(0,o.jsxs)(i.li,{children:["\n",(0,o.jsxs)(i.p,{children:[(0,o.jsx)(i.code,{children:"user_cmd"})," is a user-defined command."]}),"\n",(0,o.jsxs)(i.p,{children:["Possible values include: ",(0,o.jsx)(i.code,{children:"build"})," to compile platform code; ",(0,o.jsx)(i.code,{children:"clean"})," to clean build products."]}),"\n",(0,o.jsx)(i.p,{children:"You need to implement different logic in the script according to the different commands passed in."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(i.h3,{id:"about-firmware-flashing-optional",children:"About Firmware Flashing (Optional)"}),"\n",(0,o.jsxs)(i.p,{children:["The newly adapted hardware platform may require specific firmware flashing methods, and the ",(0,o.jsx)(i.code,{children:"tyutool"})," flashing tool used by ",(0,o.jsx)(i.code,{children:"TuyaOpen"})," does not provide universal flashing scripts."]}),"\n",(0,o.jsxs)(i.p,{children:["You can submit an ",(0,o.jsx)(i.code,{children:"issue"})," in the ",(0,o.jsx)(i.a,{href:"https://github.com/tuya/tyutool",children:"tyutool repository"})," to request official support."]}),"\n",(0,o.jsx)(i.h3,{id:"configure-repository-information-optional",children:"Configure Repository Information (Optional)"}),"\n",(0,o.jsxs)(i.p,{children:["Modify the ",(0,o.jsx)(i.code,{children:"platform/my_new_chip/platform_config.yaml"})," file to configure repository git information."]}),"\n",(0,o.jsx)(i.p,{children:"This operation is for cases where you need to provide the newly created platform to other developers."}),"\n",(0,o.jsx)(i.p,{children:"If you are using it locally, you can ignore this step."}),"\n",(0,o.jsx)(i.h2,{id:"faq",children:"FAQ"})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,o.jsx)(i,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},12744:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-prepare-085fb62a73b742da4e566541e774a84a.png"},15756:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-toolchain-a40ddd7a7f6a89b9ca6594661b8b65c9.png"},28453:(e,i,n)=>{n.d(i,{R:()=>l,x:()=>s});var t=n(96540);const o={},r=t.createContext(o);function l(e){const i=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(r.Provider,{value:i},e.children)}},34717:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-build-ca6d8d17dd2ddf32a444f5e1721fb628.png"},41724:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-menu-cf0734c0b66f5a5ce7769a5e7d7f5746.png"},47913:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-input-7bc2d5c588b5ed3f9a457f98ce2321d7.png"},58381:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-filelist2-b43cd6f527c5b15ac77b208553c9c011.png"},68236:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-generate-fdcc5994e0e355bb0f0f22a82b6b47d5.png"},70779:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-build2-9b8f6eb6ef98c35d22ba8a6db16a5221.png"},83847:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-config-e069179b7f62afda95fbb58eafeaf709.png"},99407:(e,i,n)=>{n.d(i,{A:()=>t});const t=n.p+"assets/images/new-platform-filelist-1146c6a2fc5971c240ff144f85786971.png"}}]);