"use strict";(self.webpackChunktuyaopen_io_website=self.webpackChunktuyaopen_io_website||[]).push([["5008"],{2081(e,t,r){r.r(t),r.d(t,{metadata:()=>i,default:()=>o,frontMatter:()=>s,contentTitle:()=>d,toc:()=>a,assets:()=>c});var i=JSON.parse('{"id":"tkl-api/tkl_timer","title":"tkl_timer | Timer Driver","description":"Overview","source":"@site/docs/tkl-api/tkl_timer.md","sourceDirName":"tkl-api","slug":"/tkl-api/tkl_timer","permalink":"/docs/tkl-api/tkl_timer","draft":false,"unlisted":false,"editUrl":"https://github.com/Tuya-Community/TuyaOpen.io/edit/master/docs/tkl-api/tkl_timer.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"tkl_system | System Interfaces","permalink":"/docs/tkl-api/tkl_system"},"next":{"title":"tkl_thread | Thread","permalink":"/docs/tkl-api/tkl_thread"}}'),n=r(4848),l=r(8453);let s={},d="tkl_timer | Timer Driver",c={},a=[{value:"Overview",id:"overview",level:2},{value:"API description",id:"api-description",level:2},{value:"tkl_timer_init",id:"tkl_timer_init",level:3},{value:"tkl_timer_deinit",id:"tkl_timer_deinit",level:3},{value:"tkl_timer_start",id:"tkl_timer_start",level:3},{value:"tkl_timer_stop",id:"tkl_timer_stop",level:3},{value:"tkl_timer_get",id:"tkl_timer_get",level:3},{value:"tkl_timer_get_current_value",id:"tkl_timer_get_current_value",level:3},{value:"Example",id:"example",level:2}];function _(e){let t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"tkl_timer--timer-driver",children:"tkl_timer | Timer Driver"})}),"\n",(0,n.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsx)(t.p,{children:"A timer is an on-chip peripheral in microprocessors used for time measurement. Depending on the actual configuration requirements, different timing precisions are typically available, such as 16-bit and 32-bit. During practical use, configure parameters including the timer period, counting mode, and interrupt service routine."}),"\n",(0,n.jsx)(t.h2,{id:"api-description",children:"API description"}),"\n",(0,n.jsx)(t.h3,{id:"tkl_timer_init",children:"tkl_timer_init"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"OPERATE_RET tkl_timer_init(TUYA_TIMER_NUM_E timer_id, TUYA_TIMER_BASE_CFG_T *cfg);\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Feature: Initializes the specified timer instance using the port number and basic configuration, and returns the initialization result."}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"timer_id"}),": The port number."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"cfg"}),": The basic configuration of the timer, including timing mode, callback function, and callback function parameters."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"typedef struct {\n    TKL_TIMER_MODE_E    mode;\n    TKL_TIMER_ISR_CB    cb;\n    void                    *args;\n} TUYA_TIMER_BASE_CFG_T;\n"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"TKL_TIMER_MODE_E"}),":"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Definition"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TKL_TIMER_MODE_ONCE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"One-shot timer."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TKL_TIMER_MODE_PERIOD"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Periodic timer."})]})]})]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Return value: ",(0,n.jsx)(t.code,{children:"OPRT_OK"})," indicates a success. Any other value indicates an error. For detailed error codes, refer to ",(0,n.jsx)(t.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"tkl_timer_deinit",children:"tkl_timer_deinit"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"OPERATE_RET tkl_timer_deinit(TUYA_TIMER_NUM_E timer_id);\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Feature:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Deinitializes the timer instance."}),"\n",(0,n.jsx)(t.li,{children:"This interface will stop the timer and release related software and hardware resources."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["Parameter: ",(0,n.jsx)(t.code,{children:"timer_id"})," indicates the port number."]}),"\n",(0,n.jsxs)(t.li,{children:["Return value: ",(0,n.jsx)(t.code,{children:"OPRT_OK"})," indicates a success. Any other value indicates an error. For detailed error codes, refer to ",(0,n.jsx)(t.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"tkl_timer_start",children:"tkl_timer_start"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"OPERATE_RET tkl_timer_start(TUYA_TIMER_NUM_E timer_id, uint32_t us);\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Feature: Starts the timer."}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Parameters:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"timer_id"}),": The port number."]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"us"}),": The timing interval of the timer."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsxs)(t.p,{children:["Return value: ",(0,n.jsx)(t.code,{children:"OPRT_OK"})," indicates a success. Any other value indicates an error. For detailed error codes, refer to ",(0,n.jsx)(t.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"tkl_timer_stop",children:"tkl_timer_stop"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"OPERATE_RET tkl_timer_stop(TKL_TIMER_PORT_E port);\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Feature: Stops the timer."}),"\n",(0,n.jsxs)(t.li,{children:["Parameter: ",(0,n.jsx)(t.code,{children:"port"})," indicates the port number."]}),"\n",(0,n.jsxs)(t.li,{children:["Return value: ",(0,n.jsx)(t.code,{children:"OPRT_OK"})," indicates a success. Any other value indicates an error. For detailed error codes, refer to ",(0,n.jsx)(t.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"tkl_timer_get",children:"tkl_timer_get"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"OPERATE_RET tkl_timer_get(TKL_TIMER_PORT_E port, uint32_t *us);\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Feature: Gets the timing interval of the timer."}),"\n",(0,n.jsxs)(t.li,{children:["Parameters:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"port"}),": The port number."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"us"}),": The timing interval value, unit: \u03BCs, corresponding to the value set by ",(0,n.jsx)(t.code,{children:"tkl_timer_start"}),"."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["Return value: ",(0,n.jsx)(t.code,{children:"OPRT_OK"})," indicates a success. Any other value indicates an error. For detailed error codes, refer to ",(0,n.jsx)(t.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"tkl_timer_get_current_value",children:"tkl_timer_get_current_value"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:"OPERATE_RET tkl_timer_get_current_value(TUYA_TIMER_NUM_E timer_id, uint32_t *us);\n"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Feature: Gets the actual count value of the timer."}),"\n",(0,n.jsxs)(t.li,{children:["Parameters:","\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"timer_id"}),": The port number."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"us"}),": The actual count value, unit: \u03BCs."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["Return value: ",(0,n.jsx)(t.code,{children:"OPRT_OK"})," indicates a success. Any other value indicates an error. For detailed error codes, refer to ",(0,n.jsx)(t.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"example",children:"Example"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-c",children:'static void tkl_timer_isr_cb_fun(void *args)\n{\n	PR_NOTICE("hw_timer test");\n}\n\nvoid tuya_timer_test(void)\n{\n    OPERATE_RET ret;\n 	TUYA_TIMER_BASE_CFG_T cfg;\n    uint32_t interval_us;\n    uint32_t get_us\uFF1B\n\n    cfg.mode = TUYA_TIMER_MODE_PERIOD;\n    cfg.cb = tkl_timer_isr_cb_fun;\n    cfg.arg = NULL;\n\n    ret = tkl_timer_init(TUYA_TIMER_NUM_0, &cfg);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    ret = tkl_timer_start(TUYA_TIMER_NUM_0, 1000);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    tkl_system_delay(5000);\n    ret = tkl_timer_stop(TUYA_TIMER_NUM_0);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    ret = tkl_timer_get(TUYA_TIMER_NUM_0, &interval_us);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n	if(interval_us != 2000){\n        interval_us = 2000;\n    }\n    ret = tkl_timer_start(TUYA_TIMER_NUM_0, interval_us);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    tkl_system_delay(1000);\n    ret = tkl_timer_get_current_value(TUYA_TIMER_NUM_0, &get_us);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    PR_DEBUG("current run time:%d us", get_us);\n    tkl_system_delay(5000);\n    //uninitialize iic\n    ret = tkl_timer_deinit(TUYA_TIMER_NUM_0);\n    if (ret != 0) {\n       //failed\n    }\n}\n'})})]})}function o(e={}){let{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(_,{...e})}):_(e)}},8453(e,t,r){r.d(t,{R:()=>s,x:()=>d});var i=r(6540);let n={},l=i.createContext(n);function s(e){let t=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),i.createElement(l.Provider,{value:t},e.children)}}}]);