<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="971px" preserveAspectRatio="none" style="width:1467px;height:971px;background:#FFFFFF;" version="1.1" viewBox="0 0 1467 971" width="1467px" zoomAndPan="magnify"><defs><filter height="300%" id="f841ho8mpei5f" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f841ho8mpei5f)" height="103.5313" style="stroke:#000000;stroke-width:2.0;" width="457.5" x="10" y="84.2969"/><rect fill="#FFFFFF" filter="url(#f841ho8mpei5f)" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="431" x="375.5" y="244.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="46" x2="46" y1="67.2969" y2="902.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="421.5" x2="421.5" y1="67.2969" y2="902.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="754.5" x2="754.5" y1="67.2969" y2="902.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1114" x2="1114" y1="67.2969" y2="902.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1348.5" x2="1348.5" y1="67.2969" y2="902.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1425.5" x2="1425.5" y1="67.2969" y2="902.75"/><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="51.9951">input</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="901.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="921.7451">input</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="385.5" y="63.9951">recording</text><path d="M403.5,15 C403.5,5 421.5,5 421.5,5 C421.5,5 439.5,5 439.5,15 L439.5,41 C439.5,51 421.5,51 421.5,51 C421.5,51 403.5,51 403.5,41 L403.5,15 " fill="#FEFECE" filter="url(#f841ho8mpei5f)" style="stroke:#000000;stroke-width:1.5;"/><path d="M403.5,15 C403.5,25 421.5,25 421.5,25 C421.5,25 439.5,25 439.5,15 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="385.5" y="914.7451">recording</text><path d="M403.5,928.0469 C403.5,918.0469 421.5,918.0469 421.5,918.0469 C421.5,918.0469 439.5,918.0469 439.5,928.0469 L439.5,954.0469 C439.5,964.0469 421.5,964.0469 421.5,964.0469 C421.5,964.0469 403.5,964.0469 403.5,954.0469 L403.5,928.0469 " fill="#FEFECE" filter="url(#f841ho8mpei5f)" style="stroke:#000000;stroke-width:1.5;"/><path d="M403.5,928.0469 C403.5,938.0469 421.5,938.0469 421.5,938.0469 C421.5,938.0469 439.5,938.0469 439.5,928.0469 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="712.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="719.5" y="51.9951">cloud_asr</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="712.5" y="901.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="719.5" y="921.7451">cloud_asr</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="1089" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="1096" y="51.9951">main</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="1089" y="901.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="1096" y="921.7451">main</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1310.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1317.5" y="51.9951">ai_agent</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1310.5" y="901.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1317.5" y="921.7451">ai_agent</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="1396.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="1403.5" y="51.9951">player</text><rect fill="#FEFECE" filter="url(#f841ho8mpei5f)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="1396.5" y="901.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="1403.5" y="921.7451">player</text><path d="M10,84.2969 L87,84.2969 L87,91.2969 L77,101.2969 L10,101.2969 L10,84.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="103.5313" style="stroke:#000000;stroke-width:2.0;" width="457.5" x="10" y="84.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="97.3638">loop</text><polygon fill="#A80036" points="409.5,133.6953,419.5,137.6953,409.5,141.6953,413.5,137.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="415.5" y1="137.6953" y2="137.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351" x="53.5" y="117.4966">Continuously record and save the collected audio data,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="53.5" y="132.6294">write once every ~10ms</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="166.8281" y2="166.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="166.8281" y2="179.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="179.8281" y2="179.8281"/><polygon fill="#A80036" points="57.5,175.8281,47.5,179.8281,57.5,183.8281,53.5,179.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="53.5" y="161.7622">Perform VAD detection on the collected audio data</text><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1460.5" x="0" y="215.3945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="215.3945" y2="215.3945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="218.3945" y2="218.3945"/><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="209" x="625.75" y="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="190" x="631.75" y="220.895">No human voice detected</text><path d="M375.5,244.9609 L452.5,244.9609 L452.5,251.9609 L442.5,261.9609 L375.5,261.9609 L375.5,244.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="431" x="375.5" y="244.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="390.5" y="258.0278">loop</text><polygon fill="#A80036" points="432.5,294.3594,422.5,298.3594,432.5,302.3594,428.5,298.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="426.5" x2="753.5" y1="298.3594" y2="298.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="438.5" y="278.1606">Only save the most recent 600ms of audio data,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="438.5" y="293.2935">for cloud VAD usage</text><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1460.5" x="0" y="333.9258"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="333.9258" y2="333.9258"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="336.9258" y2="336.9258"/><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="186" x="637.25" y="323.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="643.25" y="339.4263">Human voice detected</text><polygon fill="#A80036" points="1102.5,373.625,1112.5,377.625,1102.5,381.625,1106.5,377.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="1108.5" y1="377.625" y2="377.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="53.5" y="372.5591">Valid audio data detected</text><polygon fill="#A80036" points="765.5,402.7578,755.5,406.7578,765.5,410.7578,761.5,406.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="759.5" x2="1113.5" y1="406.7578" y2="406.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="771.5" y="401.6919">Start reporting task</text><polygon fill="#A80036" points="1336.5,431.8906,1346.5,435.8906,1336.5,439.8906,1340.5,435.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="754.5" x2="1342.5" y1="435.8906" y2="435.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="761.5" y="430.8247">Start reporting</text><polygon fill="#A80036" points="432.5,461.0234,422.5,465.0234,432.5,469.0234,428.5,465.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="426.5" x2="753.5" y1="465.0234" y2="465.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="438.5" y="459.9575">Read audio data</text><polygon fill="#A80036" points="1336.5,490.1563,1346.5,494.1563,1336.5,498.1563,1340.5,494.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="754.5" x2="1342.5" y1="494.1563" y2="494.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="761.5" y="489.0903">Report audio data stream</text><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1460.5" x="0" y="522.7227"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="522.7227" y2="522.7227"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="525.7227" y2="525.7227"/><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="237" x="611.75" y="512.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="218" x="617.75" y="528.2231">End of human voice detected</text><polygon fill="#A80036" points="1102.5,562.4219,1112.5,566.4219,1102.5,570.4219,1106.5,566.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="1108.5" y1="566.4219" y2="566.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="53.5" y="561.356">Valid audio data collection ended</text><polygon fill="#A80036" points="765.5,591.5547,755.5,595.5547,765.5,599.5547,761.5,595.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="759.5" x2="1113.5" y1="595.5547" y2="595.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="771.5" y="590.4888">End reporting task</text><polygon fill="#A80036" points="432.5,620.6875,422.5,624.6875,432.5,628.6875,428.5,624.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="426.5" x2="753.5" y1="624.6875" y2="624.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="438.5" y="619.6216">Read remaining cached audio data</text><polygon fill="#A80036" points="1336.5,649.8203,1346.5,653.8203,1336.5,657.8203,1340.5,653.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="754.5" x2="1342.5" y1="653.8203" y2="653.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="761.5" y="648.7544">Report audio data stream</text><polygon fill="#A80036" points="1336.5,678.9531,1346.5,682.9531,1336.5,686.9531,1340.5,682.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="754.5" x2="1342.5" y1="682.9531" y2="682.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="761.5" y="677.8872">End audio stream reporting</text><line style="stroke:#A80036;stroke-width:1.0;" x1="754.5" x2="796.5" y1="712.0859" y2="712.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="796.5" x2="796.5" y1="712.0859" y2="725.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="755.5" x2="796.5" y1="725.0859" y2="725.0859"/><polygon fill="#A80036" points="765.5,721.0859,755.5,725.0859,765.5,729.0859,761.5,725.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="761.5" y="707.02">Wait for cloud ASR</text><polygon fill="#A80036" points="1125.5,750.2188,1115.5,754.2188,1125.5,758.2188,1121.5,754.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1119.5" x2="1347.5" y1="754.2188" y2="754.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1131.5" y="749.1528">Return text after ASR</text><polygon fill="#A80036" points="765.5,779.3516,755.5,783.3516,765.5,787.3516,761.5,783.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="759.5" x2="1113.5" y1="783.3516" y2="783.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336" x="771.5" y="778.2856">ASR result received, reporting state can become idle</text><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1460.5" x="0" y="811.918"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="811.918" y2="811.918"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1460.5" y1="814.918" y2="814.918"/><rect fill="#EEEEEE" filter="url(#f841ho8mpei5f)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="261" x="599.75" y="801.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="242" x="605.75" y="817.4185">Cloud sends AI reply information</text><polygon fill="#A80036" points="1125.5,851.6172,1115.5,855.6172,1125.5,859.6172,1121.5,855.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1119.5" x2="1347.5" y1="855.6172" y2="855.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="1131.5" y="850.5513">Notify text and audio information</text><polygon fill="#A80036" points="1414,880.75,1424,884.75,1414,888.75,1418,884.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1114.5" x2="1420" y1="884.75" y2="884.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="1121.5" y="879.6841">Play audio data sent from</text><!--MD5=[cdf2c5f1abc43d7c252e46fea488fc2a]
@startuml
participant input 
database recording
loop
input - -> recording: Continuously record and save the collected audio data,\nwrite once every ~10ms
input -> input: Perform VAD detection on the collected audio data
end
== No human voice detected ==
loop
cloud_asr - -> recording: Only save the most recent 600ms of audio data,\nfor cloud VAD usage
end
== Human voice detected ==
input -> main: Valid audio data detected
main -> cloud_asr: Start reporting task
cloud_asr -> ai_agent: Start reporting
cloud_asr - -> recording: Read audio data
cloud_asr -> ai_agent: Report audio data stream
== End of human voice detected ==
input -> main: Valid audio data collection ended
main -> cloud_asr: End reporting task
cloud_asr- -> recording: Read remaining cached audio data
cloud_asr -> ai_agent: Report audio data stream
cloud_asr -> ai_agent: End audio stream reporting
cloud_asr -> cloud_asr: Wait for cloud ASR
ai_agent -> main: Return text after ASR
main -> cloud_asr: ASR result received, reporting state can become idle
== Cloud sends AI reply information ==
ai_agent -> main: Notify text and audio information
main -> player: Play audio data sent from
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>