<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1334px" preserveAspectRatio="none" style="width:1552px;height:1334px;background:#FFFFFF;" version="1.1" viewBox="0 0 1552 1334" width="1552px" zoomAndPan="magnify"><defs><filter height="300%" id="fjo1rr82ff9pa" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fjo1rr82ff9pa)" height="118.6641" style="stroke:#000000;stroke-width:2.0;" width="526.5" x="10" y="84.2969"/><rect fill="#FFFFFF" filter="url(#fjo1rr82ff9pa)" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="431" x="444.5" y="260.0938"/><rect fill="#FFFFFF" filter="url(#fjo1rr82ff9pa)" height="117.5313" style="stroke:#000000;stroke-width:2.0;" width="1439" x="10" y="435.8906"/><rect fill="#FFFFFF" filter="url(#fjo1rr82ff9pa)" height="553.3906" style="stroke:#000000;stroke-width:2.0;" width="1525" x="10" y="695.8203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="46" x2="46" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="490.5" x2="490.5" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="823.5" x2="823.5" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1183" x2="1183" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1409" x2="1409" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1487" x2="1487" y1="67.2969" y2="1266.2109"/><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="51.9951">input</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="1285.2061">input</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="454.5" y="63.9951">recording</text><path d="M472.5,15 C472.5,5 490.5,5 490.5,5 C490.5,5 508.5,5 508.5,15 L508.5,41 C508.5,51 490.5,51 490.5,51 C490.5,51 472.5,51 472.5,41 L472.5,15 " fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" style="stroke:#000000;stroke-width:1.5;"/><path d="M472.5,15 C472.5,25 490.5,25 490.5,25 C490.5,25 508.5,25 508.5,15 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="454.5" y="1278.2061">recording</text><path d="M472.5,1291.5078 C472.5,1281.5078 490.5,1281.5078 490.5,1281.5078 C490.5,1281.5078 508.5,1281.5078 508.5,1291.5078 L508.5,1317.5078 C508.5,1327.5078 490.5,1327.5078 490.5,1327.5078 C490.5,1327.5078 472.5,1327.5078 472.5,1317.5078 L472.5,1291.5078 " fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" style="stroke:#000000;stroke-width:1.5;"/><path d="M472.5,1291.5078 C472.5,1301.5078 490.5,1301.5078 490.5,1301.5078 C490.5,1301.5078 508.5,1301.5078 508.5,1291.5078 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="781.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="788.5" y="51.9951">cloud_asr</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="781.5" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="788.5" y="1285.2061">cloud_asr</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="1158" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="1165" y="51.9951">main</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="1158" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="1165" y="1285.2061">main</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="1380" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="1387" y="51.9951">player</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="1380" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="1387" y="1285.2061">player</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1449" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1456" y="51.9951">ai_agent</text><rect fill="#FEFECE" filter="url(#fjo1rr82ff9pa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1449" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1456" y="1285.2061">ai_agent</text><path d="M10,84.2969 L87,84.2969 L87,91.2969 L77,101.2969 L10,101.2969 L10,84.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="118.6641" style="stroke:#000000;stroke-width:2.0;" width="526.5" x="10" y="84.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="97.3638">loop</text><polygon fill="#A80036" points="478.5,133.6953,488.5,137.6953,478.5,141.6953,482.5,137.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="484.5" y1="137.6953" y2="137.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351" x="53.5" y="117.4966">Continuously record and save the collected audio data,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="53.5" y="132.6294">write once every ~10ms</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="181.9609" y2="181.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="181.9609" y2="194.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="194.9609" y2="194.9609"/><polygon fill="#A80036" points="57.5,190.9609,47.5,194.9609,57.5,198.9609,53.5,194.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329" x="53.5" y="161.7622">Perform VAD detection on the collected audio data,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="53.5" y="176.895">return whether human voice is detected</text><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1545" x="0" y="230.5273"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="230.5273" y2="230.5273"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="233.5273" y2="233.5273"/><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="209" x="668" y="219.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="190" x="674" y="236.0278">No human voice detected</text><path d="M444.5,260.0938 L521.5,260.0938 L521.5,267.0938 L511.5,277.0938 L444.5,277.0938 L444.5,260.0938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="431" x="444.5" y="260.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="459.5" y="273.1606">loop</text><polygon fill="#A80036" points="501.5,309.4922,491.5,313.4922,501.5,317.4922,497.5,313.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="495.5" x2="822.5" y1="313.4922" y2="313.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="507.5" y="293.2935">Only save the most recent 600ms of audio data,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="507.5" y="308.4263">for cloud VAD usage</text><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1545" x="0" y="349.0586"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="349.0586" y2="349.0586"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="352.0586" y2="352.0586"/><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="186" x="679.5" y="338.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167" x="685.5" y="354.5591">Human voice detected</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="407.8906" y2="407.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="407.8906" y2="420.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="420.8906" y2="420.8906"/><polygon fill="#A80036" points="57.5,416.8906,47.5,420.8906,57.5,424.8906,53.5,420.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="430" x="53.5" y="387.6919">Perform local ASR wake word detection on the collected audio data,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="53.5" y="402.8247">return whether the wake word is detected</text><path d="M10,435.8906 L74,435.8906 L74,442.8906 L64,452.8906 L10,452.8906 L10,435.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:2.0;" width="1439" x="10" y="435.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="448.9575">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="143" x="89" y="448.1011">[Wake word detected]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="474.1563" y2="474.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="474.1563" y2="487.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="487.1563" y2="487.1563"/><polygon fill="#A80036" points="57.5,483.1563,47.5,487.1563,57.5,491.1563,53.5,487.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="53.5" y="469.0903">Enter wake-up state</text><polygon fill="#A80036" points="1171.5,512.2891,1181.5,516.2891,1171.5,520.2891,1175.5,516.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="1177.5" y1="516.2891" y2="516.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="53.5" y="511.2231">Notify that wake word is detected</text><polygon fill="#A80036" points="1397.5,541.4219,1407.5,545.4219,1397.5,549.4219,1401.5,545.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1183.5" x2="1403.5" y1="545.4219" y2="545.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1190.5" y="540.356">Play prompt sound</text><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1545" x="0" y="580.9883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="580.9883" y2="580.9883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="583.9883" y2="583.9883"/><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="500" x="522.5" y="570.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="481" x="528.5" y="586.4888">30 seconds after wake word detected, no human voice detected</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="624.6875" y2="624.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="624.6875" y2="637.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="637.6875" y2="637.6875"/><polygon fill="#A80036" points="57.5,633.6875,47.5,637.6875,57.5,641.6875,53.5,637.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="53.5" y="619.6216">Return to wake word detection state</text><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1545" x="0" y="666.2539"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="666.2539" y2="666.2539"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="669.2539" y2="669.2539"/><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="435" x="555" y="655.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="416" x="561" y="671.7544">After wake word detected, human voice detected again</text><path d="M10,695.8203 L87,695.8203 L87,702.8203 L77,712.8203 L10,712.8203 L10,695.8203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="553.3906" style="stroke:#000000;stroke-width:2.0;" width="1525" x="10" y="695.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="708.8872">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="415" x="102" y="708.0308">[Within wake-up timeout, human voice is continuously detected]</text><polygon fill="#A80036" points="1171.5,730.0859,1181.5,734.0859,1171.5,738.0859,1175.5,734.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="1177.5" y1="734.0859" y2="734.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="53.5" y="729.02">Valid audio data detected</text><polygon fill="#A80036" points="834.5,759.2188,824.5,763.2188,834.5,767.2188,830.5,763.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="828.5" x2="1182.5" y1="763.2188" y2="763.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="840.5" y="758.1528">Start reporting task</text><polygon fill="#A80036" points="1475,788.3516,1485,792.3516,1475,796.3516,1479,792.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="823.5" x2="1481" y1="792.3516" y2="792.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="830.5" y="787.2856">Start reporting</text><polygon fill="#A80036" points="501.5,817.4844,491.5,821.4844,501.5,825.4844,497.5,821.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="495.5" x2="822.5" y1="821.4844" y2="821.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="507.5" y="816.4185">Read audio data</text><polygon fill="#A80036" points="1475,846.6172,1485,850.6172,1475,854.6172,1479,850.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="823.5" x2="1481" y1="850.6172" y2="850.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="830.5" y="845.5513">Report audio data stream</text><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1545" x="0" y="879.1836"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="879.1836" y2="879.1836"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="882.1836" y2="882.1836"/><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="237" x="654" y="868.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="218" x="660" y="884.6841">End of human voice detected</text><polygon fill="#A80036" points="1171.5,918.8828,1181.5,922.8828,1171.5,926.8828,1175.5,922.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="1177.5" y1="922.8828" y2="922.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="53.5" y="917.8169">Valid audio data collection ended</text><polygon fill="#A80036" points="834.5,948.0156,824.5,952.0156,834.5,956.0156,830.5,952.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="828.5" x2="1182.5" y1="952.0156" y2="952.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="840.5" y="946.9497">End reporting task</text><polygon fill="#A80036" points="501.5,977.1484,491.5,981.1484,501.5,985.1484,497.5,981.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="495.5" x2="822.5" y1="981.1484" y2="981.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="507.5" y="976.0825">Read remaining cached audio data</text><polygon fill="#A80036" points="1475,1006.2813,1485,1010.2813,1475,1014.2813,1479,1010.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="823.5" x2="1481" y1="1010.2813" y2="1010.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="830.5" y="1005.2153">Report audio data stream</text><polygon fill="#A80036" points="1475,1035.4141,1485,1039.4141,1475,1043.4141,1479,1039.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="823.5" x2="1481" y1="1039.4141" y2="1039.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="830.5" y="1034.3481">End audio stream reporting</text><line style="stroke:#A80036;stroke-width:1.0;" x1="823.5" x2="865.5" y1="1068.5469" y2="1068.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="865.5" x2="865.5" y1="1068.5469" y2="1081.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="824.5" x2="865.5" y1="1081.5469" y2="1081.5469"/><polygon fill="#A80036" points="834.5,1077.5469,824.5,1081.5469,834.5,1085.5469,830.5,1081.5469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="830.5" y="1063.481">Wait for cloud ASR</text><polygon fill="#A80036" points="1194.5,1106.6797,1184.5,1110.6797,1194.5,1114.6797,1190.5,1110.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1188.5" x2="1486" y1="1110.6797" y2="1110.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1200.5" y="1105.6138">Return text after ASR</text><polygon fill="#A80036" points="834.5,1135.8125,824.5,1139.8125,834.5,1143.8125,830.5,1139.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="828.5" x2="1182.5" y1="1139.8125" y2="1139.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336" x="840.5" y="1134.7466">ASR result received, reporting state can become idle</text><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1545" x="0" y="1168.3789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="1168.3789" y2="1168.3789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1545" y1="1171.3789" y2="1171.3789"/><rect fill="#EEEEEE" filter="url(#fjo1rr82ff9pa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="261" x="642" y="1157.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="242" x="648" y="1173.8794">Cloud sends AI reply information</text><polygon fill="#A80036" points="1194.5,1208.0781,1184.5,1212.0781,1194.5,1216.0781,1190.5,1212.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1188.5" x2="1486" y1="1212.0781" y2="1212.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="1200.5" y="1207.0122">Notify text and audio information</text><polygon fill="#A80036" points="1397.5,1237.2109,1407.5,1241.2109,1397.5,1245.2109,1401.5,1241.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1183.5" x2="1403.5" y1="1241.2109" y2="1241.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="1190.5" y="1236.145">Play audio data sent from cloud</text><!--MD5=[b2f1eb288cf2e6dbbf16c20f8a28b6e2]
@startuml
participant input 
database recording

loop
input - -> recording: Continuously record and save the collected audio data,\nwrite once every ~10ms
input -> input : Perform VAD detection on the collected audio data,\nreturn whether human voice is detected
end
== No human voice detected ==
loop
cloud_asr - -> recording: Only save the most recent 600ms of audio data,\nfor cloud VAD usage
end
== Human voice detected ==
input -> input : Perform local ASR wake word detection on the collected audio data,\nreturn whether the wake word is detected
alt Wake word detected
input -> input : Enter wake-up state
input -> main: Notify that wake word is detected
main -> player: Play prompt sound
end
== 30 seconds after wake word detected, no human voice detected ==
input -> input : Return to wake word detection state
== After wake word detected, human voice detected again ==
loop  Within wake-up timeout, human voice is continuously detected
input -> main: Valid audio data detected
main -> cloud_asr: Start reporting task
cloud_asr -> ai_agent: Start reporting
cloud_asr - -> recording: Read audio data
cloud_asr -> ai_agent: Report audio data stream
== End of human voice detected ==
input -> main: Valid audio data collection ended
main -> cloud_asr: End reporting task
cloud_asr- -> recording: Read remaining cached audio data
cloud_asr -> ai_agent: Report audio data stream
cloud_asr -> ai_agent: End audio stream reporting
cloud_asr -> cloud_asr: Wait for cloud ASR
ai_agent -> main: Return text after ASR
main -> cloud_asr: ASR result received, reporting state can become idle
== Cloud sends AI reply information ==
ai_agent -> main: Notify text and audio information
main -> player: Play audio data sent from cloud
end
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>