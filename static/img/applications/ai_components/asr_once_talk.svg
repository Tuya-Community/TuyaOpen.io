<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1302px" preserveAspectRatio="none" style="width:1098px;height:1302px;background:#FFFFFF;" version="1.1" viewBox="0 0 1098 1302" width="1098px" zoomAndPan="magnify"><defs><filter height="300%" id="ftkh1hbh25vok" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#ftkh1hbh25vok)" height="103.5313" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="10" y="84.2969"/><rect fill="#FFFFFF" filter="url(#ftkh1hbh25vok)" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="322" x="267.5" y="244.9609"/><rect fill="#FFFFFF" filter="url(#ftkh1hbh25vok)" height="117.5313" style="stroke:#000000;stroke-width:2.0;" width="1000" x="10" y="405.625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="46" x2="46" y1="67.2969" y2="1233.9453"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="313.5" x2="313.5" y1="67.2969" y2="1233.9453"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="537.5" x2="537.5" y1="67.2969" y2="1233.9453"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="803" x2="803" y1="67.2969" y2="1233.9453"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="970" x2="970" y1="67.2969" y2="1233.9453"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1048" x2="1048" y1="67.2969" y2="1233.9453"/><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="51.9951">input</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="1232.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="1252.9404">input</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="277.5" y="63.9951">recording</text><path d="M295.5,15 C295.5,5 313.5,5 313.5,5 C313.5,5 331.5,5 331.5,15 L331.5,41 C331.5,51 313.5,51 313.5,51 C313.5,51 295.5,51 295.5,41 L295.5,15 " fill="#FEFECE" filter="url(#ftkh1hbh25vok)" style="stroke:#000000;stroke-width:1.5;"/><path d="M295.5,15 C295.5,25 313.5,25 313.5,25 C313.5,25 331.5,25 331.5,15 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="277.5" y="1245.9404">recording</text><path d="M295.5,1259.2422 C295.5,1249.2422 313.5,1249.2422 313.5,1249.2422 C313.5,1249.2422 331.5,1249.2422 331.5,1259.2422 L331.5,1285.2422 C331.5,1295.2422 313.5,1295.2422 313.5,1295.2422 C313.5,1295.2422 295.5,1295.2422 295.5,1285.2422 L295.5,1259.2422 " fill="#FEFECE" filter="url(#ftkh1hbh25vok)" style="stroke:#000000;stroke-width:1.5;"/><path d="M295.5,1259.2422 C295.5,1269.2422 313.5,1269.2422 313.5,1269.2422 C313.5,1269.2422 331.5,1269.2422 331.5,1259.2422 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="495.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="502.5" y="51.9951">cloud_asr</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="495.5" y="1232.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="502.5" y="1252.9404">cloud_asr</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="778" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="785" y="51.9951">main</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="778" y="1232.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="785" y="1252.9404">main</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="941" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="948" y="51.9951">player</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="941" y="1232.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="948" y="1252.9404">player</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1010" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1017" y="51.9951">ai_agent</text><rect fill="#FEFECE" filter="url(#ftkh1hbh25vok)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1010" y="1232.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1017" y="1252.9404">ai_agent</text><path d="M10,84.2969 L87,84.2969 L87,91.2969 L77,101.2969 L10,101.2969 L10,84.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="103.5313" style="stroke:#000000;stroke-width:2.0;" width="349.5" x="10" y="84.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="97.3638">loop</text><polygon fill="#A80036" points="301.5,133.6953,311.5,137.6953,301.5,141.6953,305.5,137.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="307.5" y1="137.6953" y2="137.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="53.5" y="117.4966">一直录音，保存采集到的音频数据，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="53.5" y="132.6294">大约10ms写入一次</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="166.8281" y2="166.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="166.8281" y2="179.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="179.8281" y2="179.8281"/><polygon fill="#A80036" points="57.5,175.8281,47.5,179.8281,57.5,183.8281,53.5,179.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="53.5" y="161.7622">将采集的音频数据进行 vad 检测</text><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1091" x="0" y="215.3945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="215.3945" y2="215.3945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="218.3945" y2="218.3945"/><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="97" x="497" y="204.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="78" x="503" y="220.895">未检测到人声</text><path d="M267.5,244.9609 L344.5,244.9609 L344.5,251.9609 L334.5,261.9609 L267.5,261.9609 L267.5,244.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="322" x="267.5" y="244.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="282.5" y="258.0278">loop</text><polygon fill="#A80036" points="324.5,294.3594,314.5,298.3594,324.5,302.3594,320.5,298.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="318.5" x2="536.5" y1="298.3594" y2="298.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="330.5" y="278.1606">只保存最近的600ms的音频数据，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="330.5" y="293.2935">用于给云端 vad 的数据</text><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1091" x="0" y="333.9258"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="333.9258" y2="333.9258"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="336.9258" y2="336.9258"/><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="84" x="503.5" y="323.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="509.5" y="339.4263">检测到人声</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="377.625" y2="377.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="377.625" y2="390.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="390.625" y2="390.625"/><polygon fill="#A80036" points="57.5,386.625,47.5,390.625,57.5,394.625,53.5,390.625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="53.5" y="372.5591">将采集的音频数据进行 本地 asr 检测唤醒词</text><path d="M10,405.625 L74,405.625 L74,412.625 L64,422.625 L10,422.625 L10,405.625 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:2.0;" width="1000" x="10" y="405.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="418.6919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="76" x="89" y="417.8354">[检测到唤醒词]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="443.8906" y2="443.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="443.8906" y2="456.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="456.8906" y2="456.8906"/><polygon fill="#A80036" points="57.5,452.8906,47.5,456.8906,57.5,460.8906,53.5,456.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="53.5" y="438.8247">进入检测有效音频状态</text><polygon fill="#A80036" points="791.5,482.0234,801.5,486.0234,791.5,490.0234,795.5,486.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="797.5" y1="486.0234" y2="486.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="53.5" y="480.9575">通知检测到唤醒词</text><polygon fill="#A80036" points="958.5,511.1563,968.5,515.1563,958.5,519.1563,962.5,515.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="803.5" x2="964.5" y1="515.1563" y2="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="810.5" y="510.0903">播放提示音</text><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1091" x="0" y="550.7227"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="550.7227" y2="550.7227"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="553.7227" y2="553.7227"/><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="246" x="422.5" y="540.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="227" x="428.5" y="556.2231">检测唤醒词后 30S内均没有检测到人声</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="594.4219" y2="594.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="594.4219" y2="607.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="607.4219" y2="607.4219"/><polygon fill="#A80036" points="57.5,603.4219,47.5,607.4219,57.5,611.4219,53.5,607.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="53.5" y="589.356">回到检测唤醒词状态</text><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1091" x="0" y="635.9883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="635.9883" y2="635.9883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="638.9883" y2="638.9883"/><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="193" x="449" y="625.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174" x="455" y="641.4888">检测唤醒词后 再次检测到人声</text><polygon fill="#A80036" points="791.5,675.6875,801.5,679.6875,791.5,683.6875,795.5,679.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="797.5" y1="679.6875" y2="679.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="53.5" y="674.6216">检测到有效音频数据</text><polygon fill="#A80036" points="548.5,704.8203,538.5,708.8203,548.5,712.8203,544.5,708.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="542.5" x2="802.5" y1="708.8203" y2="708.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="554.5" y="703.7544">开始进入上报任务</text><polygon fill="#A80036" points="1036,733.9531,1046,737.9531,1036,741.9531,1040,737.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="1042" y1="737.9531" y2="737.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="544.5" y="732.8872">开启上报</text><polygon fill="#A80036" points="324.5,763.0859,314.5,767.0859,324.5,771.0859,320.5,767.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="318.5" x2="536.5" y1="767.0859" y2="767.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="330.5" y="762.02">读取音频数据</text><polygon fill="#A80036" points="1036,792.2188,1046,796.2188,1036,800.2188,1040,796.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="1042" y1="796.2188" y2="796.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="544.5" y="791.1528">上报音频数据流</text><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1091" x="0" y="824.7852"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="824.7852" y2="824.7852"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="827.7852" y2="827.7852"/><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="110" x="490.5" y="814.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="496.5" y="830.2856">检测到人声结束</text><polygon fill="#A80036" points="791.5,864.4844,801.5,868.4844,791.5,872.4844,795.5,868.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="797.5" y1="868.4844" y2="868.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="53.5" y="863.4185">有效音频数据采集结束</text><polygon fill="#A80036" points="548.5,893.6172,538.5,897.6172,548.5,901.6172,544.5,897.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="542.5" x2="802.5" y1="897.6172" y2="897.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="554.5" y="892.5513">结束上报任务</text><polygon fill="#A80036" points="57.5,922.75,47.5,926.75,57.5,930.75,53.5,926.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="51.5" x2="802.5" y1="926.75" y2="926.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="63.5" y="921.6841">回到检测唤醒词状态</text><polygon fill="#A80036" points="324.5,951.8828,314.5,955.8828,324.5,959.8828,320.5,955.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="318.5" x2="536.5" y1="955.8828" y2="955.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="330.5" y="950.8169">读完缓存中的音频数据</text><polygon fill="#A80036" points="1036,981.0156,1046,985.0156,1036,989.0156,1040,985.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="1042" y1="985.0156" y2="985.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="544.5" y="979.9497">上报音频数据流</text><polygon fill="#A80036" points="1036,1010.1484,1046,1014.1484,1036,1018.1484,1040,1014.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="1042" y1="1014.1484" y2="1014.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="544.5" y="1009.0825">结束音频流上报</text><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="579.5" y1="1043.2813" y2="1043.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="579.5" x2="579.5" y1="1043.2813" y2="1056.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="538.5" x2="579.5" y1="1056.2813" y2="1056.2813"/><polygon fill="#A80036" points="548.5,1052.2813,538.5,1056.2813,548.5,1060.2813,544.5,1056.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="544.5" y="1038.2153">等待云端 ASR</text><polygon fill="#A80036" points="814.5,1081.4141,804.5,1085.4141,814.5,1089.4141,810.5,1085.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="808.5" x2="1047" y1="1085.4141" y2="1085.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="820.5" y="1080.3481">返回 ASR 后的文本</text><polygon fill="#A80036" points="548.5,1110.5469,538.5,1114.5469,548.5,1118.5469,544.5,1114.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="542.5" x2="802.5" y1="1114.5469" y2="1114.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="554.5" y="1109.481">已收到 ASR 结果，上报状态可变成空闲态</text><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1091" x="0" y="1143.1133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="1143.1133" y2="1143.1133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1091" y1="1146.1133" y2="1146.1133"/><rect fill="#EEEEEE" filter="url(#ftkh1hbh25vok)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="147" x="472" y="1132.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="478" y="1148.6138">云端下发 AI 回复信息</text><polygon fill="#A80036" points="814.5,1182.8125,804.5,1186.8125,814.5,1190.8125,810.5,1186.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="808.5" x2="1047" y1="1186.8125" y2="1186.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="820.5" y="1181.7466">通知文本信息以及音频信息</text><polygon fill="#A80036" points="958.5,1211.9453,968.5,1215.9453,958.5,1219.9453,962.5,1215.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="803.5" x2="964.5" y1="1215.9453" y2="1215.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="810.5" y="1210.8794">播放云端下发的音频数据</text><!--MD5=[a64a74c6843cb6fe388a6cba2375c04f]
@startuml
participant input 
database recording
loop
input - -> recording: 一直录音，保存采集到的音频数据，\n大约10ms写入一次
input -> input: 将采集的音频数据进行 vad 检测
end
== 未检测到人声 ==
loop
cloud_asr - -> recording: 只保存最近的600ms的音频数据，\n用于给云端 vad 的数据
end
== 检测到人声 ==
input -> input: 将采集的音频数据进行 本地 asr 检测唤醒词
alt 检测到唤醒词
input -> input:进入检测有效音频状态
input -> main: 通知检测到唤醒词
main -> player:播放提示音
end
== 检测唤醒词后 30S内均没有检测到人声 ==
input-> input:回到检测唤醒词状态
== 检测唤醒词后 再次检测到人声 ==
input -> main:检测到有效音频数据
main -> cloud_asr:开始进入上报任务
cloud_asr -> ai_agent: 开启上报
cloud_asr - -> recording: 读取音频数据
cloud_asr -> ai_agent:上报音频数据流
== 检测到人声结束 ==
input -> main:有效音频数据采集结束
main -> cloud_asr:结束上报任务
main -> input:回到检测唤醒词状态
cloud_asr- -> recording: 读完缓存中的音频数据
cloud_asr -> ai_agent:上报音频数据流
cloud_asr -> ai_agent:结束音频流上报
cloud_asr -> cloud_asr: 等待云端 ASR
ai_agent -> main: 返回 ASR 后的文本
main -> cloud_asr:已收到 ASR 结果，上报状态可变成空闲态
== 云端下发 AI 回复信息 ==
ai_agent -> main:通知文本信息以及音频信息
main -> player:播放云端下发的音频数据
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>