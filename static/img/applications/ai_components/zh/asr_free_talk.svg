<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1334px" preserveAspectRatio="none" style="width:1117px;height:1334px;background:#FFFFFF;" version="1.1" viewBox="0 0 1117 1334" width="1117px" zoomAndPan="magnify"><defs><filter height="300%" id="f1i0e544r756fx" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1i0e544r756fx)" height="118.6641" style="stroke:#000000;stroke-width:2.0;" width="353.5" x="10" y="84.2969"/><rect fill="#FFFFFF" filter="url(#f1i0e544r756fx)" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="322" x="271.5" y="260.0938"/><rect fill="#FFFFFF" filter="url(#f1i0e544r756fx)" height="117.5313" style="stroke:#000000;stroke-width:2.0;" width="1004" x="10" y="435.8906"/><rect fill="#FFFFFF" filter="url(#f1i0e544r756fx)" height="553.3906" style="stroke:#000000;stroke-width:2.0;" width="1090" x="10" y="695.8203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="46" x2="46" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="317.5" x2="317.5" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="541.5" x2="541.5" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="807" x2="807" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="974" x2="974" y1="67.2969" y2="1266.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1052" x2="1052" y1="67.2969" y2="1266.2109"/><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="51.9951">input</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="49" x="20" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="27" y="1285.2061">input</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="281.5" y="63.9951">recording</text><path d="M299.5,15 C299.5,5 317.5,5 317.5,5 C317.5,5 335.5,5 335.5,15 L335.5,41 C335.5,51 317.5,51 317.5,51 C317.5,51 299.5,51 299.5,41 L299.5,15 " fill="#FEFECE" filter="url(#f1i0e544r756fx)" style="stroke:#000000;stroke-width:1.5;"/><path d="M299.5,15 C299.5,25 317.5,25 317.5,25 C317.5,25 335.5,25 335.5,15 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="281.5" y="1278.2061">recording</text><path d="M299.5,1291.5078 C299.5,1281.5078 317.5,1281.5078 317.5,1281.5078 C317.5,1281.5078 335.5,1281.5078 335.5,1291.5078 L335.5,1317.5078 C335.5,1327.5078 317.5,1327.5078 317.5,1327.5078 C317.5,1327.5078 299.5,1327.5078 299.5,1317.5078 L299.5,1291.5078 " fill="#FEFECE" filter="url(#f1i0e544r756fx)" style="stroke:#000000;stroke-width:1.5;"/><path d="M299.5,1291.5078 C299.5,1301.5078 317.5,1301.5078 317.5,1301.5078 C317.5,1301.5078 335.5,1301.5078 335.5,1291.5078 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="499.5" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="506.5" y="51.9951">cloud_asr</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="499.5" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="506.5" y="1285.2061">cloud_asr</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="782" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="789" y="51.9951">main</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="47" x="782" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="789" y="1285.2061">main</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="945" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="952" y="51.9951">player</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="55" x="945" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="952" y="1285.2061">player</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1014" y="32"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1021" y="51.9951">ai_agent</text><rect fill="#FEFECE" filter="url(#f1i0e544r756fx)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="1014" y="1265.2109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="1021" y="1285.2061">ai_agent</text><path d="M10,84.2969 L87,84.2969 L87,91.2969 L77,101.2969 L10,101.2969 L10,84.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="118.6641" style="stroke:#000000;stroke-width:2.0;" width="353.5" x="10" y="84.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="97.3638">loop</text><polygon fill="#A80036" points="305.5,133.6953,315.5,137.6953,305.5,141.6953,309.5,137.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="311.5" y1="137.6953" y2="137.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="53.5" y="117.4966">一直录音，保存采集到的音频数据，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="53.5" y="132.6294">大约10ms写入一次</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="181.9609" y2="181.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="181.9609" y2="194.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="194.9609" y2="194.9609"/><polygon fill="#A80036" points="57.5,190.9609,47.5,194.9609,57.5,198.9609,53.5,194.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="53.5" y="161.7622">将采集的音频数据进行 vad 检测,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="53.5" y="176.895">返回是否检测到人声的结果</text><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1110" x="0" y="230.5273"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="230.5273" y2="230.5273"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="233.5273" y2="233.5273"/><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="97" x="506.5" y="219.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="78" x="512.5" y="236.0278">未检测到人声</text><path d="M271.5,260.0938 L348.5,260.0938 L348.5,267.0938 L338.5,277.0938 L271.5,277.0938 L271.5,260.0938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.3984" style="stroke:#000000;stroke-width:2.0;" width="322" x="271.5" y="260.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="286.5" y="273.1606">loop</text><polygon fill="#A80036" points="328.5,309.4922,318.5,313.4922,328.5,317.4922,324.5,313.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322.5" x2="540.5" y1="313.4922" y2="313.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="334.5" y="293.2935">只保存最近的600ms的音频数据，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="334.5" y="308.4263">用于给云端 vad 的数据</text><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1110" x="0" y="349.0586"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="349.0586" y2="349.0586"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="352.0586" y2="352.0586"/><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="84" x="513" y="338.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="519" y="354.5591">检测到人声</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="407.8906" y2="407.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="407.8906" y2="420.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="420.8906" y2="420.8906"/><polygon fill="#A80036" points="57.5,416.8906,47.5,420.8906,57.5,424.8906,53.5,420.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="53.5" y="387.6919">将采集的音频数据进行本地 asr 检测唤醒词,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="53.5" y="402.8247">返回是否检测到唤醒词的结果</text><path d="M10,435.8906 L74,435.8906 L74,442.8906 L64,452.8906 L10,452.8906 L10,435.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:2.0;" width="1004" x="10" y="435.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="448.9575">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="76" x="89" y="448.1011">[检测到唤醒词]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="474.1563" y2="474.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="474.1563" y2="487.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="487.1563" y2="487.1563"/><polygon fill="#A80036" points="57.5,483.1563,47.5,487.1563,57.5,491.1563,53.5,487.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="53.5" y="469.0903">进入被唤醒状态</text><polygon fill="#A80036" points="795.5,512.2891,805.5,516.2891,795.5,520.2891,799.5,516.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="801.5" y1="516.2891" y2="516.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="53.5" y="511.2231">通知检测到唤醒词</text><polygon fill="#A80036" points="962.5,541.4219,972.5,545.4219,962.5,549.4219,966.5,545.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="807.5" x2="968.5" y1="545.4219" y2="545.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="814.5" y="540.356">播放提示音</text><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1110" x="0" y="580.9883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="580.9883" y2="580.9883"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="583.9883" y2="583.9883"/><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="243" x="433.5" y="570.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="224" x="439.5" y="586.4888">检测唤醒词后 有 30S 没有检测到人声</text><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="88.5" y1="624.6875" y2="624.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="88.5" x2="88.5" y1="624.6875" y2="637.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="47.5" x2="88.5" y1="637.6875" y2="637.6875"/><polygon fill="#A80036" points="57.5,633.6875,47.5,637.6875,57.5,641.6875,53.5,637.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="53.5" y="619.6216">回到检测唤醒词状态</text><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1110" x="0" y="666.2539"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="666.2539" y2="666.2539"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="669.2539" y2="669.2539"/><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="193" x="458.5" y="655.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174" x="464.5" y="671.7544">检测唤醒词后 再次检测到人声</text><path d="M10,695.8203 L87,695.8203 L87,702.8203 L77,712.8203 L10,712.8203 L10,695.8203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="553.3906" style="stroke:#000000;stroke-width:2.0;" width="1090" x="10" y="695.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="708.8872">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="186" x="102" y="708.0308">[唤醒超时时间内，一直有检测到人声]</text><polygon fill="#A80036" points="795.5,730.0859,805.5,734.0859,795.5,738.0859,799.5,734.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="801.5" y1="734.0859" y2="734.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="53.5" y="729.02">检测到有效音频数据</text><polygon fill="#A80036" points="552.5,759.2188,542.5,763.2188,552.5,767.2188,548.5,763.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546.5" x2="806.5" y1="763.2188" y2="763.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="558.5" y="758.1528">开始进入上报任务</text><polygon fill="#A80036" points="1040,788.3516,1050,792.3516,1040,796.3516,1044,792.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541.5" x2="1046" y1="792.3516" y2="792.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="548.5" y="787.2856">开启上报</text><polygon fill="#A80036" points="328.5,817.4844,318.5,821.4844,328.5,825.4844,324.5,821.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322.5" x2="540.5" y1="821.4844" y2="821.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="334.5" y="816.4185">读取音频数据</text><polygon fill="#A80036" points="1040,846.6172,1050,850.6172,1040,854.6172,1044,850.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541.5" x2="1046" y1="850.6172" y2="850.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="548.5" y="845.5513">上报音频数据流</text><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1110" x="0" y="879.1836"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="879.1836" y2="879.1836"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="882.1836" y2="882.1836"/><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="110" x="500" y="868.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="506" y="884.6841">检测到人声结束</text><polygon fill="#A80036" points="795.5,918.8828,805.5,922.8828,795.5,926.8828,799.5,922.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="46.5" x2="801.5" y1="922.8828" y2="922.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="53.5" y="917.8169">有效音频数据采集结束</text><polygon fill="#A80036" points="552.5,948.0156,542.5,952.0156,552.5,956.0156,548.5,952.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546.5" x2="806.5" y1="952.0156" y2="952.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="558.5" y="946.9497">结束上报任务</text><polygon fill="#A80036" points="328.5,977.1484,318.5,981.1484,328.5,985.1484,324.5,981.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322.5" x2="540.5" y1="981.1484" y2="981.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="334.5" y="976.0825">读完缓存中的音频数据</text><polygon fill="#A80036" points="1040,1006.2813,1050,1010.2813,1040,1014.2813,1044,1010.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541.5" x2="1046" y1="1010.2813" y2="1010.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="548.5" y="1005.2153">上报音频数据流</text><polygon fill="#A80036" points="1040,1035.4141,1050,1039.4141,1040,1043.4141,1044,1039.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541.5" x2="1046" y1="1039.4141" y2="1039.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="548.5" y="1034.3481">结束音频流上报</text><line style="stroke:#A80036;stroke-width:1.0;" x1="541.5" x2="583.5" y1="1068.5469" y2="1068.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="583.5" x2="583.5" y1="1068.5469" y2="1081.5469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="542.5" x2="583.5" y1="1081.5469" y2="1081.5469"/><polygon fill="#A80036" points="552.5,1077.5469,542.5,1081.5469,552.5,1085.5469,548.5,1081.5469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="548.5" y="1063.481">等待云端 ASR</text><polygon fill="#A80036" points="818.5,1106.6797,808.5,1110.6797,818.5,1114.6797,814.5,1110.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="812.5" x2="1051" y1="1110.6797" y2="1110.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="824.5" y="1105.6138">返回 ASR 后的文本</text><polygon fill="#A80036" points="552.5,1135.8125,542.5,1139.8125,552.5,1143.8125,548.5,1139.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546.5" x2="806.5" y1="1139.8125" y2="1139.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="558.5" y="1134.7466">已收到 ASR 结果，上报状态可变成空闲态</text><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1110" x="0" y="1168.3789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="1168.3789" y2="1168.3789"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1110" y1="1171.3789" y2="1171.3789"/><rect fill="#EEEEEE" filter="url(#f1i0e544r756fx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="147" x="481.5" y="1157.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="487.5" y="1173.8794">云端下发 AI 回复信息</text><polygon fill="#A80036" points="818.5,1208.0781,808.5,1212.0781,818.5,1216.0781,814.5,1212.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="812.5" x2="1051" y1="1212.0781" y2="1212.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="824.5" y="1207.0122">通知文本信息以及音频信息</text><polygon fill="#A80036" points="962.5,1237.2109,972.5,1241.2109,962.5,1245.2109,966.5,1241.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="807.5" x2="968.5" y1="1241.2109" y2="1241.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="814.5" y="1236.145">播放云端下发的音频数据</text><!--MD5=[971a4341d5d1423bf140e7738565de64]
@startuml
participant input 
database recording

loop
input - -> recording: 一直录音，保存采集到的音频数据，\n大约10ms写入一次
input -> input : 将采集的音频数据进行 vad 检测, \n返回是否检测到人声的结果
end
== 未检测到人声 ==
loop
cloud_asr - -> recording: 只保存最近的600ms的音频数据，\n用于给云端 vad 的数据
end
== 检测到人声 ==
input -> input : 将采集的音频数据进行本地 asr 检测唤醒词, \n返回是否检测到唤醒词的结果
alt 检测到唤醒词
input -> input :进入被唤醒状态
input -> main: 通知检测到唤醒词
main -> player:播放提示音
end
== 检测唤醒词后 有 30S 没有检测到人声 ==
input -> input :回到检测唤醒词状态
== 检测唤醒词后 再次检测到人声 ==
loop  唤醒超时时间内，一直有检测到人声
input -> main:检测到有效音频数据
main -> cloud_asr:开始进入上报任务
cloud_asr -> ai_agent: 开启上报
cloud_asr - -> recording: 读取音频数据
cloud_asr -> ai_agent:上报音频数据流
== 检测到人声结束 ==
input -> main:有效音频数据采集结束
main -> cloud_asr:结束上报任务
cloud_asr- -> recording: 读完缓存中的音频数据
cloud_asr -> ai_agent:上报音频数据流
cloud_asr -> ai_agent:结束音频流上报
cloud_asr -> cloud_asr: 等待云端 ASR
ai_agent -> main: 返回 ASR 后的文本
main -> cloud_asr:已收到 ASR 结果，上报状态可变成空闲态
== 云端下发 AI 回复信息 ==
ai_agent -> main:通知文本信息以及音频信息
main -> player:播放云端下发的音频数据
end
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>