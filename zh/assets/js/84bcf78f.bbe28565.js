"use strict";(self.webpackChunktuyaopen_io_website=self.webpackChunktuyaopen_io_website||[]).push([["7394"],{61391:function(e,n,l){l.r(n),l.d(n,{frontMatter:()=>_,toc:()=>c,default:()=>h,metadata:()=>s,assets:()=>r,contentTitle:()=>d});var s=JSON.parse('{"id":"tkl-api/tkl_spi","title":"tkl_spi | SPI \u9A71\u52A8","description":"\u7B80\u8981\u8BF4\u660E","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/tkl-api/tkl_spi.md","sourceDirName":"tkl-api","slug":"/tkl-api/tkl_spi","permalink":"/zh/docs/tkl-api/tkl_spi","draft":false,"unlisted":false,"editUrl":"https://github.com/Tuya-Community/TuyaOpen.io/edit/master/i18n/zh/docusaurus-plugin-content-docs/current/tkl-api/tkl_spi.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"tkl_rtc | RTC \u9A71\u52A8","permalink":"/zh/docs/tkl-api/tkl_rtc"},"next":{"title":"tkl_uart | UART \u9A71\u52A8","permalink":"/zh/docs/tkl-api/tkl_uart"}}'),i=l(74848),t=l(84429);let _={},d="tkl_spi | SPI \u9A71\u52A8",r={},c=[{value:"\u7B80\u8981\u8BF4\u660E",id:"\u7B80\u8981\u8BF4\u660E",level:2},{value:"API \u63CF\u8FF0",id:"api-\u63CF\u8FF0",level:2},{value:"tkl_spi_init",id:"tkl_spi_init",level:3},{value:"TUYA_SPI_ROLE_E:",id:"tuya_spi_role_e",level:4},{value:"TUYA_SPI_MODE_E:",id:"tuya_spi_mode_e",level:4},{value:"TUYA_SPI_TYPE_E:",id:"tuya_spi_type_e",level:4},{value:"TUYA_SPI_DATABITS_E\uFF1A",id:"tuya_spi_databits_e",level:4},{value:"TUYA_SPI_BIT_ORDER_E:",id:"tuya_spi_bit_order_e",level:4},{value:"tkl_spi_deinit",id:"tkl_spi_deinit",level:3},{value:"tkl_spi_send",id:"tkl_spi_send",level:3},{value:"tkl_spi_recv",id:"tkl_spi_recv",level:3},{value:"tkl_spi_transfer",id:"tkl_spi_transfer",level:3},{value:"tkl_spi_abort_transfer",id:"tkl_spi_abort_transfer",level:3},{value:"tkl_spi_get_status",id:"tkl_spi_get_status",level:3},{value:"TUYA_SPI_STATUS_T:",id:"tuya_spi_status_t",level:4},{value:"tkl_spi_irq_init",id:"tkl_spi_irq_init",level:3},{value:"tkl_spi_irq_enable",id:"tkl_spi_irq_enable",level:3},{value:"tkl_spi_irq_disable",id:"tkl_spi_irq_disable",level:3},{value:"tkl_spi_get_data_count",id:"tkl_spi_get_data_count",level:3},{value:"1. spi \u793A\u4F8B\u4E00",id:"1-spi-\u793A\u4F8B\u4E00",level:2},{value:"2. SPI \u4F7F\u7528\u4E2D\u65AD\u793A\u4F8B\u4E8C",id:"2-spi-\u4F7F\u7528\u4E2D\u65AD\u793A\u4F8B\u4E8C",level:2}];function x(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"tkl_spi--spi-\u9A71\u52A8",children:"tkl_spi | SPI \u9A71\u52A8"})}),"\n",(0,i.jsx)(n.h2,{id:"\u7B80\u8981\u8BF4\u660E",children:"\u7B80\u8981\u8BF4\u660E"}),"\n",(0,i.jsx)(n.p,{children:"SPI\uFF08Serial Peripheral Interface\uFF09\u662F\u4E00\u79CD\u9AD8\u901F\u3001\u5168\u53CC\u5DE5\u3001\u540C\u6B65\u7684\u901A\u4FE1\u603B\u7EBF\u3002SPI \u4EE5\u4E3B\u4ECE\u65B9\u5F0F\u5DE5\u4F5C\uFF0C\u901A\u5E38\u6709\u4E00\u4E2A\u4E3B\u8BBE\u5907\u548C\u4E00\u4E2A\u6216\u591A\u4E2A\u4ECE\u8BBE\u5907\u3002"}),"\n",(0,i.jsx)(n.p,{children:"SPI \u63A7\u5236\u5668\u7684\u4FE1\u53F7\u7EBF\u63CF\u8FF0\u5982\u4E0B\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"MISO\uFF1A\u4E3B\u8BBE\u5907\u6570\u636E\u8F93\u5165\uFF0C\u4ECE\u8BBE\u5907\u6570\u636E\u8F93\u51FA\uFF1B"}),"\n",(0,i.jsx)(n.li,{children:"MOSI\uFF1A\u4E3B\u8BBE\u5907\u6570\u636E\u8F93\u51FA\uFF0C\u4ECE\u8BBE\u5907\u6570\u636E\u8F93\u5165\uFF1B"}),"\n",(0,i.jsx)(n.li,{children:"SCK\uFF1A \u65F6\u949F\u4FE1\u53F7\uFF0C\u7531\u4E3B\u8BBE\u5907\u4EA7\u751F\uFF1B"}),"\n",(0,i.jsx)(n.li,{children:"CS\uFF1A\u4ECE\u8BBE\u5907\u4F7F\u80FD\u4FE1\u53F7\uFF0C\u7531\u4E3B\u8BBE\u5907\u63A7\u5236\u3002\u8FD9\u4E2A\u4FE1\u53F7\u53EF\u4EE5\u662F SPI \u5916\u8BBE\u7684\u4E00\u90E8\u5206\uFF0C\u4E5F\u53EF\u7528GPIO\u5F15\u811A\u5B9E\u73B0\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"SPI \u5178\u578B\u63A5\u7EBF\u65B9\u5F0F\u5982\u4E0B\uFF1A"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://images.tuyacn.com/fe-static/docs/img/fd2d8ee2-cef2-44a0-ae58-7039833d1e0c.png",alt:"image-20220411140500420"})}),"\n",(0,i.jsx)(n.p,{children:"SPI \u603B\u7EBF\u652F\u6301\u7684\u56DB\u79CD\u5DE5\u4F5C\u65B9\u5F0F\uFF0C\u53D6\u51B3\u4E8E\u4E32\u884C\u540C\u6B65\u65F6\u949F\u6781\u6027 CPOL \u548C\u4E32\u884C\u540C\u6B65\u65F6\u949F\u76F8\u4F4D CPHA \u7684\u7EC4\u5408\u3002"}),"\n",(0,i.jsx)(n.p,{children:"CPOL \u662F\u7528\u6765\u51B3\u5B9A SCLK \u65F6\u949F\u4FE1\u53F7\u7A7A\u95F2\u65F6\u7684\u7535\u5E73\uFF0CCPOL=0\uFF0C\u7A7A\u95F2\u7535\u5E73\u4E3A\u4F4E\u7535\u5E73\uFF0CCPOL=1 \u65F6\uFF0C\u7A7A\u95F2\u7535\u5E73\u4E3A\u9AD8\u7535\u5E73\u3002CPHA \u662F\u7528\u6765\u51B3\u5B9A\u91C7\u6837\u65F6\u523B\u7684\uFF0CCPHA=0\uFF0C\u5728\u6BCF\u4E2A\u5468\u671F\u7684\u7B2C\u4E00\u4E2A\u65F6\u949F\u6CBF\u91C7\u6837\uFF0C\u7B2C\u4E8C\u4E2A\u65F6\u949F\u6CBF\u6570\u636E\u8F93\u51FA\uFF1BCPHA=1\uFF0C\u5728\u6BCF\u4E2A\u5468\u671F\u7684\u7B2C\u4E8C\u4E2A\u65F6\u949F\u6CBF\u91C7\u6837\uFF0C\u7B2C\u4E00\u4E2A\u65F6\u949F\u6CBF\u6570\u636E\u8F93\u51FA\u3002SPI \u4E3B\u6A21\u5757\u548C\u4E0E\u4E4B\u901A\u4FE1\u7684\u5916\u8BBE\u65F6\u949F\u76F8\u4F4D\u548C\u6781\u6027\u5E94\u8BE5\u4E00\u81F4\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u56DB\u79CD\u5DE5\u4F5C\u65B9\u5F0F\u65F6\u5E8F\u63CF\u8FF0\u5982\u4E0B\uFF1A"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u6A21\u5F0F0\uFF1ACPOL= 0\uFF0CCPHA=0\u3002SCK \u4E32\u884C\u65F6\u949F\u7EBF\u7A7A\u95F2\u662F\u4E3A\u4F4E\u7535\u5E73\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0A\u5347\u6CBF\u88AB\u91C7\u6837\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0B\u964D\u6CBF\u5207\u6362"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u6A21\u5F0F1\uFF1ACPOL= 0\uFF0CCPHA=1\u3002SCK \u4E32\u884C\u65F6\u949F\u7EBF\u7A7A\u95F2\u662F\u4E3A\u4F4E\u7535\u5E73\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0B\u964D\u6CBF\u88AB\u91C7\u6837\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0A\u5347\u6CBF\u5207\u6362"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u6A21\u5F0F2\uFF1ACPOL= 1\uFF0CCPHA=0\u3002SCK \u4E32\u884C\u65F6\u949F\u7EBF\u7A7A\u95F2\u662F\u4E3A\u9AD8\u7535\u5E73\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0B\u964D\u6CBF\u88AB\u91C7\u6837\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0A\u5347\u6CBF\u5207\u6362"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u6A21\u5F0F3\uFF1ACPOL= 1\uFF0CCPHA=1\u3002SCK \u4E32\u884C\u65F6\u949F\u7EBF\u7A7A\u95F2\u662F\u4E3A\u9AD8\u7535\u5E73\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0A\u5347\u6CBF\u88AB\u91C7\u6837\uFF0C\u6570\u636E\u5728 SCK \u65F6\u949F\u7684\u4E0B\u964D\u6CBF\u5207\u6362"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"api-\u63CF\u8FF0",children:"API \u63CF\u8FF0"}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_init",children:"tkl_spi_init"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_init(TUYA_SPI_NUM_E port, const TUYA_SPI_BASE_CFG_T *cfg);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u529F\u80FD\u63CF\u8FF0:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u901A\u8FC7\u7AEF\u53E3\u53F7\u548C\u57FA\u7840\u914D\u7F6E\u521D\u59CB\u5316\u5BF9\u5E94\u7684 SPI \u5B9E\u4F8B\uFF0C\u8FD4\u56DE\u521D\u59CB\u5316\u7ED3\u679C \u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u53C2\u6570:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cfg"}),": SPI \u57FA\u7840\u914D\u7F6E \u3002"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct {\n    TUYA_SPI_ROLE_E      role;\n    TUYA_SPI_MODE_E      mode;\n    TUYA_SPI_TYPE_E      type;\n    TUYA_SPI_DATABITS_E  databits;\n    TUYA_SPI_BIT_ORDER_E bitorder;\n    uint32_t               freq_hz;\n    uint32_t               spi_dma_flags; /*!< SPI dma format , 1 use dma */\n} TUYA_SPI_BASE_CFG_T;\n"})}),"\n",(0,i.jsx)(n.h4,{id:"tuya_spi_role_e",children:"TUYA_SPI_ROLE_E:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u540D\u5B57"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5B9A\u4E49"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5907\u6CE8"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_ROLE_INACTIVE"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"spi\u95F2\u7F6E"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_ROLE_MASTER"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"spi\u5168\u53CC\u5DE5\u4E3B\u6A21\u5F0F"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_ROLE_SLAVE"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"spi\u5168\u53CC\u5DE5\u4ECE\u6A21\u5F0F"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_ROLE_MASTER_SIMPLEX"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"spi\u534A\u53CC\u5DE5\u4E3B\u6A21\u5F0F"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_ROLE_SLAVE_SIMPLEX"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"spi\u534A\u53CC\u5DE5\u4ECE\u6A21\u5F0F"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"tuya_spi_mode_e",children:"TUYA_SPI_MODE_E:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u540D\u5B57"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5B9A\u4E49"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5907\u6CE8"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_MODE0"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"CPOL = 0, CPHA = 0"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_MODE1"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"CPOL = 0, CPHA = 1"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_MODE2"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"CPOL = 1, CPHA = 0"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"TUYA_SPI_MODE3"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"CPOL = 1, CPHA = 1"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"tuya_spi_type_e",children:"TUYA_SPI_TYPE_E:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u540D\u5B57"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5B9A\u4E49"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5907\u6CE8"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_AUTO_TYPE"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"SS\u7BA1\u811A\u6A21\u5F0F\uFF0C\u786C\u4EF6\u81EA\u52A8\u914D\u7F6E"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"SS\uFF1Aslave select\uFF0C\u5BF9\u5E94CS\u7247\u9009\u7BA1\u811A"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_SOFT_TYPE"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"SS\u7BA1\u811A\u6A21\u5F0F\uFF0C\u8F6F\u4EF6\u624B\u52A8\u914D\u7F6E"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_SOFT_ONE_WIRE_TYPE"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"\u4E09\u7EBF\u6A21\u5F0F\uFF0CSS\u7BA1\u811A\u65E0\u6548"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"tuya_spi_databits_e",children:"TUYA_SPI_DATABITS_E\uFF1A"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u540D\u5B57"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5B9A\u4E49"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5907\u6CE8"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_DATA_BIT8"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"8\u4F4D\u6570\u636E\u4F4D\u6A21\u5F0F"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_DATA_BIT16"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"16\u4F4D\u6570\u636E\u4F4D\u6A21\u5F0F"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"tuya_spi_bit_order_e",children:"TUYA_SPI_BIT_ORDER_E:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\u540D\u5B57"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5B9A\u4E49"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5907\u6CE8"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_ORDER_MSB2LSB"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"\u9AD8\u4F4D\uFF08MSB\uFF09\u5728\u524D\uFF0C\u4F4E\u4F4D\uFF08LSB\uFF09\u5728\u540E"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TUYA_SPI_ORDER_LSB2MSB"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"\u4F4E\u4F4D\uFF08LSB\uFF09\u5728\u524D\uFF0C\u9AD8\u4F4D\uFF08MSB\uFF09\u5728\u540E"}),(0,i.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u8FD4\u56DE\u503C:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6tuya_error_code.h\uFF0COS_ADAPTER_SPI\u5B9A\u4E49\u90E8\u5206\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_deinit",children:"tkl_spi_deinit"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_deinit(TUYA_SPI_NUM_E port);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SPI \u5B9E\u4F8B\u53CD\u521D\u59CB\u5316\u3002\u8BE5\u63A5\u53E3\u4F1A\u505C\u6B62 SPI"}),"\n",(0,i.jsx)(n.li,{children:"\u5B9E\u4F8B\u6B63\u5728\u8FDB\u884C\u7684\u4F20\u8F93\uFF08\u5982\u679C\u6709\uFF09\uFF0C\u5E76\u4E14\u91CA\u653E\u76F8\u5173\u7684\u8F6F\u786C\u4EF6\u8D44\u6E90\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_send",children:"tkl_spi_send"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_send(TUYA_SPI_NUM_E port, void *data, uint16_t size);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SPI \u542F\u52A8\u6570\u636E\u53D1\u9001\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"}),": \u5F85\u53D1\u9001\u6570\u636E\u7684\u7F13\u51B2\u533A\u5730\u5740\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"size"}),": \u5F85\u53D1\u9001\u6570\u636E\u7684\u957F\u5EA6\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_recv",children:"tkl_spi_recv"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_recv(TUYA_SPI_NUM_E port, void *data, uint16_t size);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SPI \u542F\u52A8\u6570\u636E\u63A5\u6536\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"data"}),": \u5F85\u63A5\u6536\u6570\u636E\u7684\u7F13\u51B2\u533A\u5730\u5740\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"size"}),": \u5F85\u63A5\u6536\u6570\u636E\u7684\u957F\u5EA6\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_transfer",children:"tkl_spi_transfer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_transfer(TUYA_SPI_NUM_E port, void* send_buf, void* receive_buf, uint32_t length);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SPI \u542F\u52A8\u6570\u636E\u4F20\u8F93\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"send_buf"}),": \u5F85\u53D1\u9001\u6570\u636E\u7684\u7F13\u51B2\u533A\u5730\u5740\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"receive_buf"}),": \u5F85\u63A5\u6536\u6570\u636E\u7684\u7F13\u51B2\u533A\u5730\u5740\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"length\uFF1A\u957F\u5EA6\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_abort_transfer",children:"tkl_spi_abort_transfer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_abort_transfer(TUYA_SPI_NUM_E port);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SPI \u7EC8\u6B62\u6570\u636E\u4F20\u8F93\uFF0C\u6216\u8005\u7EC8\u6B62\u6570\u636E\u53D1\u9001(\u63A5\u6536)\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_get_status",children:"tkl_spi_get_status"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_get_status(TUYA_SPI_NUM_E port, TUYA_SPI_STATUS_T *status);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u83B7\u53D6\u5F53\u524D\u65F6\u523B SPI \u7684\u72B6\u6001\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["SPI \u72B6\u6001\u7684\u7ED3\u6784\u4F53\uFF0CSPI \u7684\u72B6\u6001\u5B9A\u4E49\u89C1 ",(0,i.jsx)(n.code,{children:"TUYA_SPI_STATUS_T"})," \u7684\u5B9A\u4E49\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"tuya_spi_status_t",children:"TUYA_SPI_STATUS_T:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u540D\u5B57"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5B9A\u4E49"}),(0,i.jsx)(n.th,{style:{textAlign:"left"},children:"\u5907\u6CE8"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"busy : 1"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"\u4F20\u8F93/\u6536\u53D1\u5FD9\u72B6\u6001\u4F4D"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"1\u6709\u6548"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"data_lost : 1"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"\u6570\u636E\u4E22\u5931"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"1\u6709\u6548"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"mode_fault : 1"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"\u6A21\u5F0F\u9519\u8BEF"}),(0,i.jsx)(n.td,{style:{textAlign:"left"},children:"1\u6709\u6548"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_irq_init",children:"tkl_spi_irq_init"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_irq_init(TUYA_SPI_NUM_E port, TUYA_SPI_IRQ_CB cb);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SPI \u7684\u4E2D\u65AD\u521D\u59CB\u5316\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),":\u7AEF\u53E3\u53F7\u3002"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cb"}),":\u4E2D\u65AD\u56DE\u8C03\u51FD\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_irq_enable",children:"tkl_spi_irq_enable"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_irq_enable(TUYA_SPI_NUM_E port);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4F7F\u80FD SPI \u7684\u4E2D\u65AD\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),":\u7AEF\u53E3\u53F7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_irq_disable",children:"tkl_spi_irq_disable"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_spi_irq_disable(TUYA_SPI_NUM_E port);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5173\u95ED SPI \u7684\u4E2D\u65AD\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),":\u7AEF\u53E3\u53F7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["OPRT_OK \u6210\u529F\uFF0C\u5176\u4ED6\u8BF7\u53C2\u8003\u6587\u4EF6 ",(0,i.jsx)(n.code,{children:"tuya_error_code.h"}),"\uFF0C",(0,i.jsx)(n.code,{children:"OS_ADAPTER_SPI"})," \u5B9A\u4E49\u90E8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tkl_spi_get_data_count",children:"tkl_spi_get_data_count"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"int32_t tkl_spi_get_data_count(TUYA_SPI_NUM_E port);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u529F\u80FD\u63CF\u8FF0:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u83B7\u53D6 SPI \u4F20\u8F93\u5B57\u8282\u957F\u5EA6\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u53C2\u6570:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"port"}),": \u7AEF\u53E3\u53F7\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u8FD4\u56DE\u503C < 0 \u8868\u793A\u9519\u8BEF\u3002\u8FD4\u56DE\u503C >= 0 \u8868\u793A\u6700\u540E\u4E00\u6B21\u4F20\u8F93\u7684\u5B57\u8282\u957F\u5EA6\u3002\u53EF\u4EE5\u662F ",(0,i.jsx)(n.code,{children:"tkl_spi_send"}),"\u3001",(0,i.jsx)(n.code,{children:"tkl_spi_recv"})," \u6216 ",(0,i.jsx)(n.code,{children:"tkl_spi_transfer"})," \u4EFB\u4E00\u64CD\u4F5C\u7684\u5B57\u8282\u957F\u5EA6\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"\u793A\u4F8B",children:"\u793A\u4F8B"}),"\n",(0,i.jsx)(n.h2,{id:"1-spi-\u793A\u4F8B\u4E00",children:"1. spi \u793A\u4F8B\u4E00"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"void tuya_spi_test1(void)\n{\n    OPERATE_RET ret;\n    TUYA_SPI_BASE_CFG_T cfg;\n    TUYA_SPI_STATUS_T status\uFF1B\n    //receive buffer\n    char rcv_buf[8];\n    //data to send\n    char send_buf[8] = {0,1,2,3,4,5,6,7};\n\n    tkl_io_pinmux_config(TUYA_IO_PIN_0, TUYA_SPI0_MISO);\n    tkl_io_pinmux_config(TUYA_IO_PIN_1, TUYA_SPI0_MOSI);\n    tkl_io_pinmux_config(TUYA_IO_PIN_2, TUYA_SPI0_CS);\n    tkl_io_pinmux_config(TUYA_IO_PIN_3, TUYA_SPI0_CLK);\n\n    cfg.role = TUYA_SPI_ROLE_MASTER;\n    cfg.mode = TUYA_SPI_MODE0;\n    cfg.type = TUYA_SPI_AUTO_TYPE;\n    cfg.databits = TUYA_SPI_DATA_BIT8\uFF1B\n    cfg.bitorder = TUYA_SPI_ORDER_MSB2LSB\uFF1B\n    cfg.freq_hz = 1000000\uFF1B\n\n    ret = tkl_spi_init(TUYA_SPI_NUM_0, &cfg);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n\n    ret = tkl_spi_send(TUYA_SPI_NUM_0, send_buf, 8);\n    if (ret < 0) {\n        //failed\n    }\n\n    tkl_spi_get_status(TUYA_SPI_NUM_0, &status);\n    while (status.busy) {\n        tkl_spi_get_status(TUYA_SPI_NUM_0, &status);\n        tkl_system_sleep(2);\n    }\n\n    ret = tkl_spi_recv(TUYA_SPI_NUM_0, rcv_buf, 8);\n    if (ret < 0) {\n        //failed\n    }\n\n    tkl_spi_get_status(TUYA_SPI_NUM_0, &status);\n    while (status.busy) {\n        tkl_spi_get_status(TUYA_SPI_NUM_0, &status);\n        tkl_system_sleep(2);\n    }\n    ret = tkl_spi_transfer(TUYA_SPI_NUM_0, send_buf,rcv_buf, 6);\n    if (ret < 0) {\n        //failed\n    }\n\n    tkl_spi_get_status(TUYA_SPI_NUM_0, &status);\n    while (status.busy) {\n        tkl_spi_get_status(TUYA_SPI_NUM_0, &status);\n        tkl_system_sleep(2);\n    }\n    //uninitialize iic\n    ret = tkl_spi_deinit(TUYA_SPI_NUM_0);\n    if (ret != 0) {\n       //failed\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2-spi-\u4F7F\u7528\u4E2D\u65AD\u793A\u4F8B\u4E8C",children:"2. SPI \u4F7F\u7528\u4E2D\u65AD\u793A\u4F8B\u4E8C"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:'int event_flag = -1;\nstatic void spi_event_cb(TUYA_SPI_NUM_E port, TUYA_SPI_IRQ_EVT_E event)\n{\n    //printf("\\nspi_event_cb_fun:%d\\n",event);\n    event_flag = event\uFF1B\n}\n\nvoid tuya_spi_test2(void)\n{\n    OPERATE_RET ret;\n    TUYA_SPI_BASE_CFG_T cfg;\n    TUYA_SPI_STATUS_T status\uFF1B\n    //receive buffer\n    char rcv_buf[6];\n    //data to send\n    char send_buf[6] = {0x90,0x0,0x0,0x0,0x0,0x0};\n\n    tkl_io_pinmux_config(TUYA_IO_PIN_0, TUYA_SPI0_MISO);\n    tkl_io_pinmux_config(TUYA_IO_PIN_1, TUYA_SPI0_MOSI);\n    tkl_io_pinmux_config(TUYA_IO_PIN_2, TUYA_SPI0_CS);\n    tkl_io_pinmux_config(TUYA_IO_PIN_3, TUYA_SPI0_CLK);\n\n    cfg.role = TUYA_SPI_ROLE_MASTER;\n    cfg.mode = TUYA_SPI_MODE0;\n    cfg.type = TUYA_SPI_AUTO_TYPE;\n    cfg.databits = TUYA_SPI_DATA_BIT8\uFF1B\n    cfg.bitorder = TUYA_SPI_ORDER_MSB2LSB\uFF1B\n    cfg.freq_hz = 1000000\uFF1B\n\n    ret = tkl_spi_init(TUYA_SPI_NUM_0, &cfg);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n\n    tkl_spi_irq_init(TUYA_SPI_NUM_0 , spi_event_cb);\n    tkl_spi_irq_enable(TUYA_SPI_NUM_0);\n\n    event_flag = -1;\n    ret = tkl_spi_transfer(TUYA_SPI_NUM_0, send_buf,rcv_buf, 6);\n    if (ret < 0) {\n        //failed\n    }\n\n    while (TUYA_SPI_EVENT_TRANSFER_COMPLETE != event_flag) {\n        tkl_system_sleep(2);\n    }\n    //up Transfer Complete\n    event_flag = -1;\n    ret = tkl_spi_send(TUYA_SPI_NUM_0, send_buf, 6);\n    if (ret < 0) {\n        //failed\n    }\n    while (TUYA_SPI_EVENT_TX_COMPLETE != event_flag) {\n        tkl_system_sleep(2);\n    }\n    // up send Complete,\n\n    event_flag = -1;\n    ret = tkl_spi_recv(TUYA_SPI_NUM_0, rcv_buf, 6);\n    if (ret < 0) {\n        //failed\n    }\n    while (TUYA_SPI_EVENT_RX_COMPLETE != event_flag) {\n        tkl_system_sleep(2);\n    }\n    // up recv Complete,\n    tkl_spi_irq_disable(TUYA_SPI_NUM_0);\n    //uninitialize iic\n    ret = tkl_spi_deinit(TUYA_SPI_NUM_0);\n    if (ret != 0) {\n       //failed\n    }\n}\n'})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(x,{...e})}):x(e)}},84429:function(e,n,l){l.d(n,{R:()=>_,x:()=>d});var s=l(96540);let i={},t=s.createContext(i);function _(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:_(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);