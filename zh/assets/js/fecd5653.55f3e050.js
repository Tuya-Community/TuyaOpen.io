"use strict";(self.webpackChunktuyaopen_io_website=self.webpackChunktuyaopen_io_website||[]).push([[7864],{28453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>r});var l=t(96540);const i={},_=l.createContext(i);function s(n){const e=l.useContext(_);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:s(n.components),l.createElement(_.Provider,{value:e},n.children)}},60811:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>r,default:()=>A,frontMatter:()=>s,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"tkl-api/tkl_uart","title":"tkl_uart | UART \u9a71\u52a8","description":"\u7b80\u8981\u8bf4\u660e","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/tkl-api/tkl_uart.md","sourceDirName":"tkl-api","slug":"/tkl-api/tkl_uart","permalink":"/zh/docs/tkl-api/tkl_uart","draft":false,"unlisted":false,"editUrl":"https://github.com/Tuya-Community/TuyaOpen.io/edit/master/i18n/zh/docusaurus-plugin-content-docs/current/tkl-api/tkl_uart.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"tkl_spi | SPI \u9a71\u52a8","permalink":"/zh/docs/tkl-api/tkl_spi"},"next":{"title":"tkl_wifi | Wi-Fi \u9a71\u52a8","permalink":"/zh/docs/tkl-api/tkl_wifi"}}');var i=t(74848),_=t(28453);const s={},r="tkl_uart | UART \u9a71\u52a8",d={},c=[{value:"\u7b80\u8981\u8bf4\u660e",id:"\u7b80\u8981\u8bf4\u660e",level:2},{value:"API \u63cf\u8ff0",id:"api-\u63cf\u8ff0",level:2},{value:"tkl_uart_init",id:"tkl_uart_init",level:3},{value:"TUYA_UART_PARITY_TYPE_E:",id:"tuya_uart_parity_type_e",level:4},{value:"TUYA_UART_DATA_LEN_E:",id:"tuya_uart_data_len_e",level:4},{value:"TUYA_UART_STOP_LEN_E:",id:"tuya_uart_stop_len_e",level:4},{value:"TUYA_UART_FLOWCTRL_TYPE_E:",id:"tuya_uart_flowctrl_type_e",level:4},{value:"tkl_uart_deinit:",id:"tkl_uart_deinit",level:3},{value:"tkl_uart_write:",id:"tkl_uart_write",level:3},{value:"tkl_uart_rx_irq_cb_reg:",id:"tkl_uart_rx_irq_cb_reg",level:3},{value:"tkl_uart_tx_irq_cb_reg:",id:"tkl_uart_tx_irq_cb_reg",level:3},{value:"tkl_uart_read:",id:"tkl_uart_read",level:3},{value:"tkl_uart_set_tx_int:",id:"tkl_uart_set_tx_int",level:3},{value:"tkl_uart_set_rx_flowctrl:",id:"tkl_uart_set_rx_flowctrl",level:3},{value:"tkl_uart_wait_for_data\uff1a",id:"tkl_uart_wait_for_data",level:3},{value:"tkl_uart_ioctl\uff1a",id:"tkl_uart_ioctl",level:3},{value:"TUYA_UART_IOCTL_CMD_E\uff1a",id:"tuya_uart_ioctl_cmd_e",level:4},{value:"1.uart \u793a\u4f8b\u4e00",id:"1uart-\u793a\u4f8b\u4e00",level:2},{value:"2.uart \u793a\u4f8b\u4e8c",id:"2uart-\u793a\u4f8b\u4e8c",level:2}];function x(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,_.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"tkl_uart--uart-\u9a71\u52a8",children:"tkl_uart | UART \u9a71\u52a8"})}),"\n",(0,i.jsx)(e.h2,{id:"\u7b80\u8981\u8bf4\u660e",children:"\u7b80\u8981\u8bf4\u660e"}),"\n",(0,i.jsx)(e.p,{children:"UART(Universal Asynchronous Receiver/Transmitter) \u662f\u4e00\u79cd\u901a\u7528\u4e32\u884c\u6570\u636e\u603b\u7ebf\uff0c\u7528\u4e8e\u5f02\u6b65\u901a\u4fe1\u3002\u8be5\u603b\u7ebf\u53cc\u5411\u901a\u4fe1\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5168\u53cc\u5de5\u4f20\u8f93\u548c\u63a5\u6536\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"api-\u63cf\u8ff0",children:"API \u63cf\u8ff0"}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_init",children:"tkl_uart_init"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"OPERATE_RET tkl_uart_init(TUYA_UART_NUM_E port_id, TUYA_UART_BASE_CFG_T *cfg);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u901a\u8fc7\u7aef\u53e3\u53f7\u548c\u57fa\u7840\u914d\u7f6e\u521d\u59cb\u5316\u5bf9\u5e94\u7684 UART \u5b9e\u4f8b\uff0c\u8fd4\u56de\u521d\u59cb\u5316\u7ed3\u679c \u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"port_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"cfg"}),": UART \u57fa\u7840\u914d\u7f6e\uff0c\u5305\u542b\u6ce2\u7279\u7387\uff0c\u5947\u5076\u6821\u9a8c\u4f4d\uff0c\u505c\u6b62\u4f4d\uff0c\u6d41\u63a7\u5236"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef struct {\n    uint32_t                    baudrate;\n    TUYA_UART_PARITY_TYPE_E     parity;\n    TUYA_UART_DATA_LEN_E        databits;\n    TUYA_UART_STOP_LEN_E        stopbits;\n    TUYA_UART_FLOWCTRL_TYPE_E   flowctrl;\n} TUYA_UART_BASE_CFG_T;\n"})}),"\n",(0,i.jsx)(e.h4,{id:"tuya_uart_parity_type_e",children:"TUYA_UART_PARITY_TYPE_E:"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u540d\u5b57"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5b9a\u4e49"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5907\u6ce8"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_PARITY_TYPE_NONE"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x0 (\u6ca1\u6709\u6821\u9a8c\u4f4d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_PARITY_TYPE_ODD"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x1 (\u5947\u6570\u6821\u9a8c\u4f4d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_PARITY_TYPE_EVEN"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x2 (\u5076\u6570\u6821\u9a8c\u4f4d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(e.h4,{id:"tuya_uart_data_len_e",children:"TUYA_UART_DATA_LEN_E:"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u540d\u5b57"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5b9a\u4e49"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5907\u6ce8"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_DATA_LEN_5BIT"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x5 (5\u4f4d\u6570\u636e\u957f\u5ea6)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_DATA_LEN_6BIT"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x6 (6\u4f4d\u6570\u636e\u957f\u5ea6)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_DATA_LEN_7BIT"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x7 (7\u4f4d\u6570\u636e\u957f\u5ea6)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_DATA_LEN_8BIT"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x8 (8\u4f4d\u6570\u636e\u957f\u5ea6)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(e.h4,{id:"tuya_uart_stop_len_e",children:"TUYA_UART_STOP_LEN_E:"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u540d\u5b57"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5b9a\u4e49"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5907\u6ce8"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_STOP_LEN_1BIT"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x1 (1\u4f4d\u505c\u6b62\u4f4d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_STOP_LEN_1_5BIT1"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x2 (1.5\u4f4d\u505c\u6b62\u4f4d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_STOP_LEN_2BIT"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x3 (2\u4f4d\u505c\u6b62\u4f4d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,i.jsx)(e.h4,{id:"tuya_uart_flowctrl_type_e",children:"TUYA_UART_FLOWCTRL_TYPE_E:"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u540d\u5b57"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5b9a\u4e49"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5907\u6ce8"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_FLOWCTRL_NONE"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x0 (\u6ca1\u6709\u8fdb\u884c\u6d41\u63a7\u5236)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_FLOWCTRL_RTSCTS"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x1 (\u8bf7\u6c42/\u6e05\u9664\u53d1\u9001)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_FLOWCTRL_XONXOFF"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x2 (\u6682\u505c\u4f20\u8f93/\u56de\u590d\u4f20\u8f93)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_FLOWCTRL_DTRDSR"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x3 (\u6570\u636e\u7ec8\u7aef\u51c6\u5907\u597d/\u6570\u636e\u51c6\u5907\u597d)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["OPRT_OK \u6210\u529f\uff0c\u5176\u4ed6\u8bf7\u53c2\u8003\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"tuya_error_code.h"}),"\uff0cuart type \u5b9a\u4e49\u90e8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_deinit",children:"tkl_uart_deinit:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"OPERATE_RET tkl_uart_deinit(TUYA_UART_NUM_E port_id);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"UART \u53cd\u521d\u59cb\u5316\u3002\u8be5\u63a5\u53e3\u4f1a\u505c\u6b62 UART\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u7ed3\u675f\u6b63\u5728\u8fdb\u884c\u7684\u4f20\u8f93\uff08\u5982\u679c\u6709\uff09\uff0c\u5e76\u4e14\u91ca\u653e\u76f8\u5173\u7684\u8f6f\u786c\u4ef6\u8d44\u6e90\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"port_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["OPRT_OK \u6210\u529f\uff0c\u5176\u4ed6\u8bf7\u53c2\u8003\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"tuya_error_code.h"}),"\uff0cuart type \u5b9a\u4e49\u90e8\u5206\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_write",children:"tkl_uart_write:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"int tkl_uart_write(TUYA_UART_NUM_E port_id, void *buff, uint16_t len);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"UART \u53d1\u9001\u6570\u636e\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"part_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"buff"}),": \u53d1\u9001\u6570\u636e\u7f13\u51b2\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"len"}),": \u53d1\u9001\u6570\u636e\u957f\u5ea6\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:">=0"})," \u53d1\u9001\u6570\u636e\u957f\u5ea6\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"< 0 "})," \u53d1\u9001\u6570\u636e\u9519\u8bef\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_rx_irq_cb_reg",children:"tkl_uart_rx_irq_cb_reg:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"void tkl_uart_rx_irq_cb_reg(TUYA_UART_NUM_E port_id, TUYA_UART_IRQ_CB rx_cb);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6ce8\u518c UART \u63a5\u53d7\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"part_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"rx_cb"}),": \u63a5\u53d7\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u56de\u8c03\u51fd\u6570\u7c7b\u578b ",(0,i.jsx)(e.code,{children:"TUYA_UART_IRQ_CB"})," \u5b9a\u4e49\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef void (*TUYA_UART_IRQ_CB)(TUYA_UART_NUM_E port_id);\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5176\u4e2d ",(0,i.jsx)(e.code,{children:"port_id"})," \u4e3a\u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"void"}),": \u7a7a"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_tx_irq_cb_reg",children:"tkl_uart_tx_irq_cb_reg:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"void tkl_uart_tx_irq_cb_reg(TUYA_UART_NUM_E port_id, TUYA_UART_IRQ_CB tx_cb);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6ce8\u518c UART \u63a5\u53d7\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"part_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"tx_cb"}),": \u53d1\u9001\u4e2d\u65ad\u56de\u8c03\u51fd\u6570\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u56de\u8c03\u51fd\u6570\u7c7b\u578b ",(0,i.jsx)(e.code,{children:"TUYA_UART_IRQ_CB"})," \u5b9a\u4e49\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef void (*TUYA_UART_IRQ_CB)(TUYA_UART_NUM_E port_id);\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5176\u4e2d ",(0,i.jsx)(e.code,{children:"port_id"})," \u4e3a\u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"void"}),": \u7a7a"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_read",children:"tkl_uart_read:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"int tkl_uart_read(TUYA_UART_NUM_E port_id, void *buff, uint16_t len);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8bfb\u53d6uart\u4e2d\u7684\u6570\u636e\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"part_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"buff"}),": \u6570\u636e\u63a5\u6536\u7f13\u51b2\u533a\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"len"}),": \u9700\u8981\u63a5\u53d7\u7684\u6570\u636e\u957f\u5ea6\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:">=0"})," \u53d1\u9001\u6570\u636e\u957f\u5ea6\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"< 0 "})," \u53d1\u9001\u6570\u636e\u9519\u8bef\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_set_tx_int",children:"tkl_uart_set_tx_int:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"OPERATE_RET tkl_uart_set_tx_int(TUYA_UART_NUM_E port_id, BOOL_T enable);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"enabe/disable uart \u53d1\u9001\u4e2d\u65ad"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"port_id"}),":\u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"enable"}),":\u4e2d\u65adenabel/disable","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"0: disable"}),"\n",(0,i.jsx)(e.li,{children:"1: enable"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["OPRT_OK \u6210\u529f\uff0c\u5176\u4ed6\u8bf7\u53c2\u8003\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"tuya_error_code.h"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_set_rx_flowctrl",children:"tkl_uart_set_rx_flowctrl:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"OPERATE_RET tkl_uart_set_rx_flowctrl(TUYA_UART_NUM_E port_id, BOOL_T enable);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"enable/disable uart \u63a5\u53d7\u6d41\u63a7\u5236\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"port_id"}),":\u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"enable"}),": \u6d41\u63a7\u5236 enabel/disable","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"0: disable"}),"\n",(0,i.jsx)(e.li,{children:"1: enable"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["OPRT_OK \u6210\u529f\uff0c\u5176\u4ed6\u8bf7\u53c2\u8003\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"tuya_error_code.h"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_wait_for_data",children:"tkl_uart_wait_for_data\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"OPERATE_RET tkl_uart_wait_for_data(TUYA_UART_NUM_E port_id, int timeout_ms);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7b49\u5f85\u63a5\u53d7\u6570\u636e"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"port_id"}),": \u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"timeout_ms"}),": \u7b49\u5f85\u6beb\u79d2\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["OPRT_OK \u6210\u529f\uff0c\u5176\u4ed6\u8bf7\u53c2\u8003\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"tuya_error_code.h"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"tkl_uart_ioctl",children:"tkl_uart_ioctl\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"OPERATE_RET tkl_uart_ioctl(TUYA_UART_NUM_E port_id, uint32_t cmd, void *arg);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u529f\u80fd\u63cf\u8ff0\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"uart command control"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"port_id"}),":\u7aef\u53e3\u53f7\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef enum {\n    TUYA_UART_NUM_0,\t\t    // UART 0\n    TUYA_UART_NUM_1,\t\t    // UART 1\n    TUYA_UART_NUM_2,\t        // UART 2\n    TUYA_UART_NUM_3,\t        // UART 3\n    TUYA_UART_NUM_4,\t        // UART 4\n    TUYA_UART_NUM_5,\t        // UART 5\n    TUYA_UART_NUM_MAX,\n} TUYA_UART_NUM_E;\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"cmd"}),": UART \u63a7\u5236\u547d\u4ee4\u3002"]}),"\n",(0,i.jsx)(e.h4,{id:"tuya_uart_ioctl_cmd_e",children:"TUYA_UART_IOCTL_CMD_E\uff1a"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u540d\u5b57"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5b9a\u4e49"}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"\u5907\u6ce8"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_SUSPEND_CMD"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x0 (\u6682\u505c UART)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_RESUME_CMD"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x1 (\u6062\u590d UART)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_FLUSH_CMD"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x2 (\u5237\u65b0 UART \u7f13\u51b2)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_RECONFIG_CMD"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x3 (\u91cd\u65b0\u521d\u59cb\u5316 UART)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"TUYA_UART_USER_CMD"}),(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"0x4 (\u7528\u6237\u81ea\u5b9a\u4e49\u547d\u4ee4)"}),(0,i.jsx)(e.td,{style:{textAlign:"left"}})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"arg"}),": \u5bf9\u5e94\u63a7\u5236\u547d\u4ee4\u7684\u53c2\u6570"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["OPRT_OK \u6210\u529f\uff0c\u5176\u4ed6\u8bf7\u53c2\u8003\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"tuya_error_code.h"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h1,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h2,{id:"1uart-\u793a\u4f8b\u4e00",children:"1.uart \u793a\u4f8b\u4e00"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"int uart_loopback_test(void)\n{\n    uint32_t port_id;\n    TUYA_UART_BASE_CFG_T cfg;\n    OPERATE_RET ret = OPRT_OK;\n    const int bufsize = 8;\n    unsigned char tx[bufsize], rx[bufsize];\n    int bytes;\n    int i;\n\n    // start\n    port_id = TUYA_UART_NUM_0;\n\n    cfg.baudrate = 115200;\n    cfg.databits = TUYA_UART_DATA_LEN_8BIT;\n    cfg.parity = TUYA_UART_PARITY_TYPE_NONE;\n    cfg.stopbits = TUYA_UART_STOP_LEN_1BIT;\n    cfg.flowctrl = TUYA_UART_FLOWCTRL_NONE;\n\n    ret = tkl_uart_init(port_id, &cfg);\n\n    for (i = 0; i < bufsize; i++) {\n        tx[i] = 'A' + i;\n    }\n\n    // loop 3 times\n    for(i = 0; i < 3; i ++) {\n        bzero(rx, sizeof(rx));\n\n        bytes = tkl_uart_write(port_id, tx, sizeof(tx));\n        if (bytes <= 0) {\n            // fail\n            ret = OPRT_COM_ERROR;\n         } else {\n             // wait at most 5 seconds until the data is ready\n            ret = tkl_uart_wait_for_data(port_id, 5000);\n            if (ret == OPRT_TIMEOUT) {\n               // timeout\n               tkl_uart_deinit(port_id);\n               return OPRT_COM_ERROR;\n            }\n\n            bytes = tkl_uart_read(port_id, rx, sizeof(rx));\n            if (bytes < 0) {\n                // fail\n                ret = OPRT_COM_ERROR;\n            } else {\n                if (memcmp(tx, rx, bufsize) != 0) {\n                    // data is not identical\n                    ret = OPRT_COM_ERROR;\n                } else {\n                    ret = OPRT_OK;\n                }\n            }\n        }\n\n        if (ret != OPRT_OK) {\n            // fail\n        } else {\n            // ok\n        }\n    }\n    //deinit\n    tkl_uart_deinit(port_id);\n    return ret;\n}\n\n"})}),"\n",(0,i.jsx)(e.h2,{id:"2uart-\u793a\u4f8b\u4e8c",children:"2.uart \u793a\u4f8b\u4e8c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"static int sg_rx_flag = 0;\nstatic int sg_tx_flag = 0;\n\nstatic void tuya_rx_cb(TUYA_UART_NUM_E port_id)\n{\n    // mutex lock\n    sg_rx_flag = 1;\n    // mutex unlock\n}\n\nstatic static void tuya_tx_cb(TUYA_UART_NUM_E port_id)\n{\n    // mutex lock\n    sg_tx_flag = 1;\n    // mutex unlock\n}\n\nint uart_loopback_test(void)\n{\n    uint32_t port_id;\n    TUYA_UART_BASE_CFG_T cfg;\n    OPERATE_RET ret = OPRT_OK;\n    const int bufsize = 8;\n    unsigned char tx[bufsize], rx[bufsize];\n    int bytes;\n    static int sl_first_time =1;\n    int i;\n\n    // start\n    sg_rx_flag = 0;\n    sg_tx_flag = 0;\n\n    port_id = TUYA_UART_NUM_0;\n\n    cfg.baudrate = 115200;\n    cfg.databits = TUYA_UART_DATA_LEN_8BIT;\n    cfg.parity = TUYA_UART_PARITY_TYPE_NONE;\n    cfg.stopbits = TUYA_UART_STOP_LEN_1BIT;\n    cfg.flowctrl = TUYA_UART_FLOWCTRL_NONE;\n\n    ret = tkl_uart_init(port_id, &cfg);\n\n    if(tkl_uart_set_tx_int(port_id,1) < 0) {\n        //fail\n        tkl_uart_deinit(port_id);\n        return OPRT_COM_ERROR;\n    }\n\n    for (i = 0; i < bufsize; i++) {\n        tx[i] = 'A' + i;\n    }\n\n    // loop 3 times\n    for(i=0;i<3;i++) {\n\n        bzero(rx, sizeof(rx));\n\n\n        if(sl_first_time || sg_tx_flag) {\n            bytes = tkl_uart_write(port_id, tx, sizeof(tx));\n        }else {\n            continue;\n        }\n\n        if (bytes <= 0) {\n            // fail\n             ret = OPRT_COM_ERROR;\n        } else {\n        // wait at most 5 seconds until the data is ready\n        ret = tkl_uart_wait_for_data(port_id, 5000);\n\n        if(sg_rx_flag) {\n            bytes = tkl_uart_read(port_id, rx, sizeof(rx));\n            if (bytes < 0) {\n               // fail\n               ret = OPRT_COM_ERROR;\n            } else {\n                if (memcmp(tx, rx, bufsize) != 0) {\n                // data is not identical\n                ret = OPRT_COM_ERROR;\n                } else {\n                    ret = OPRT_OK;\n                }\n            }\n            sg_rx_flag = 0;\n           }\n        }\n        if (ret != OPRT_OK) {\n        // fail\n        } else {\n        // ok\n        }\n    }\n    // disabe int\n    tkl_uart_set_tx_int(port_id,0);\n    //deinit\n    tkl_uart_deinit(port_id);\n    return ret;\n}\n\n"})})]})}function A(n={}){const{wrapper:e}={...(0,_.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(x,{...n})}):x(n)}}}]);